var CSDLEditor={};
(function(k,x){k.Loader={compnts:[],loaded:[],isLoaded:!1,addComponent:function(t){"function"===typeof t&&k.Loader.compnts.push(t)},addLoaded:function(t){"function"===typeof t&&k.Loader.loaded.push(t)},load:function(){var t=x.jQuery;t(function(){t.each(k.Loader.compnts,function(){this.apply(x,[t,k])});t.each(k.Loader.loaded,function(){this.apply(x,[t,k])});k.Loader.isLoaded=!0})},timeout:function(t){setTimeout(function(){x.jQuery?(t&&x.jQuery.noConflict(),k.Loader.load()):k.Loader.timeout()},100)}};
k.onLoad=function(t){if("function"!==typeof t)return!1;k.Loader.isLoaded?t.apply(x,[x.jQuery]):k.Loader.addLoaded(t)}})(CSDLEditor,window);window.CodeMirror=function(){function k(a,b){if(!(this instanceof k))return new k(a,b);this.options=b=b||{};for(var c in $b)!b.hasOwnProperty(c)&&$b.hasOwnProperty(c)&&(b[c]=$b[c]);f(b);c="string"==typeof b.value?0:b.value.first;var e={},g=e.input=C("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none; font-size: 4px;");fa?g.style.width="1000px":g.setAttribute("wrap","off");bb&&(g.style.border="1px solid black");g.setAttribute("autocorrect","off");g.setAttribute("autocapitalize",
"off");e.inputDiv=C("div",[g],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");e.scrollbarH=C("div",[C("div",null,null,"height: 1px")],"CodeMirror-hscrollbar");e.scrollbarV=C("div",[C("div",null,null,"width: 1px")],"CodeMirror-vscrollbar");e.scrollbarFiller=C("div",null,"CodeMirror-scrollbar-filler");e.lineDiv=C("div");e.selectionDiv=C("div",null,null,"position: relative; z-index: 1");e.cursor=C("div","\u00a0","CodeMirror-cursor");e.otherCursor=C("div","\u00a0","CodeMirror-cursor CodeMirror-secondarycursor");
e.measure=C("div",null,"CodeMirror-measure");e.lineSpace=C("div",[e.measure,e.selectionDiv,e.lineDiv,e.cursor,e.otherCursor],null,"position: relative; outline: none");e.mover=C("div",[C("div",[e.lineSpace],"CodeMirror-lines")],null,"position: relative");e.sizer=C("div",[e.mover],"CodeMirror-sizer");e.heightForcer=C("div",null,null,"position: absolute; height: "+cb+"px; width: 1px;");e.gutters=C("div",null,"CodeMirror-gutters");e.lineGutter=null;var l=C("div",[e.sizer,e.heightForcer,e.gutters],null,
"position: relative; min-height: 100%");e.scroller=C("div",[l],"CodeMirror-scroll");e.scroller.setAttribute("tabIndex","-1");e.wrapper=C("div",[e.inputDiv,e.scrollbarH,e.scrollbarV,e.scrollbarFiller,e.scroller],"CodeMirror");Na&&(e.gutters.style.zIndex=-1,e.scroller.style.paddingRight=0);a.appendChild?a.appendChild(e.wrapper):a(e.wrapper);bb&&(g.style.width="0px");fa||(e.scroller.draggable=!0);ac?(e.inputDiv.style.height="1px",e.inputDiv.style.position="absolute"):Na&&(e.scrollbarH.style.minWidth=
e.scrollbarV.style.minWidth="18px");e.viewOffset=e.lastSizeC=0;e.showingFrom=e.showingTo=c;e.lineNumWidth=e.lineNumInnerWidth=e.lineNumChars=null;e.prevInput="";e.alignWidgets=!1;e.pollingFast=!1;e.poll=new bc;e.cachedCharWidth=e.cachedTextHeight=null;e.measureLineCache=[];e.measureLineCachePos=0;e.inaccurateSelection=!1;e.maxLine=null;e.maxLineLength=0;e.maxLineChanged=!1;e.wheelDX=e.wheelDY=e.wheelStartX=e.wheelStartY=null;c=this.display=e;c.wrapper.CodeMirror=this;j(this);b.autofocus&&!cc&&ba(this);
this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,draggingText:!1,highlight:new bc};r(this);b.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");e=b.value;"string"==typeof e&&(e=new ca(b.value,b.mode));A(this,Hc)(this,e);R&&setTimeout(ga(va,this,!0),20);var q=this,e=function(){q.state.focused&&setTimeout(ga(ba,q),0)},Ba=function(){d.cachedCharWidth=d.cachedTextHeight=null;ja(q);Ic(q,ga(S,q))},v=function(){for(var a=d.wrapper.parentNode;a&&
a!=document.body;a=a.parentNode);a?setTimeout(v,5E3):ra(window,"resize",Ba)},g=function(a){(!q.options.onDragEvent||!q.options.onDragEvent(q,db(a)))&&eb(a)},l=function(){d.inaccurateSelection&&(d.prevInput="",d.inaccurateSelection=!1,d.input.value=q.getSelection(),Jc(d.input))},d=q.display;H(d.scroller,"mousedown",A(q,Ld));R?H(d.scroller,"dblclick",A(q,function(a){var b=Oa(q,a);b&&(!Kc(q,a)&&!Ca(q.display,a))&&(T(a),a=dc(D(q.doc,b.line).text,b),U(q.doc,a.from,a.to))})):H(d.scroller,"dblclick",T);
H(d.lineSpace,"selectstart",function(a){Ca(d,a)||T(a)});ec||H(d.scroller,"contextmenu",function(a){Lc(q,a)});H(d.scroller,"scroll",function(){d.scroller.clientHeight&&(fb(q,d.scroller.scrollTop),Pa(q,d.scroller.scrollLeft,!0),X(q,"scroll",q))});H(d.scrollbarV,"scroll",function(){d.scroller.clientHeight&&fb(q,d.scrollbarV.scrollTop)});H(d.scrollbarH,"scroll",function(){d.scroller.clientHeight&&Pa(q,d.scrollbarH.scrollLeft)});H(d.scroller,"mousewheel",function(a){Mc(q,a)});H(d.scroller,"DOMMouseScroll",
function(a){Mc(q,a)});H(d.scrollbarH,"mousedown",e);H(d.scrollbarV,"mousedown",e);H(d.wrapper,"scroll",function(){d.wrapper.scrollTop=d.wrapper.scrollLeft=0});H(window,"resize",Ba);setTimeout(v,5E3);H(d.input,"keyup",A(q,function(a){if((!q.options.onKeyEvent||!q.options.onKeyEvent(q,db(a)))&&16==a.keyCode)q.doc.sel.shift=!1}));H(d.input,"input",ga(gb,q));H(d.input,"keydown",A(q,Nc));H(d.input,"keypress",A(q,Md));H(d.input,"focus",ga(Da,q));H(d.input,"blur",ga(fc,q));q.options.dragDrop&&(H(d.scroller,
"dragstart",function(a){if(R&&!q.state.draggingText)eb(a);else if(!Ca(q.display,a)){var b=q.getSelection();a.dataTransfer.setData("Text",b);a.dataTransfer.setDragImage&&(b=C("img",null,null,"position: fixed; left: 0; top: 0;"),ka&&(b.width=b.height=1,q.display.wrapper.appendChild(b),b._top=b.offsetTop),gc&&(q.display.dragImg?b=q.display.dragImg:(q.display.dragImg=b,b.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",q.display.wrapper.appendChild(b))),a.dataTransfer.setDragImage(b,
0,0),ka&&b.parentNode.removeChild(b))}}),H(d.scroller,"dragenter",g),H(d.scroller,"dragover",g),H(d.scroller,"drop",A(q,Nd)));H(d.scroller,"paste",function(a){Ca(d,a)||(ba(q),gb(q))});H(d.input,"paste",function(){q.state.pasteIncoming=!0;gb(q)});H(d.input,"cut",l);H(d.input,"copy",l);ac&&H(d.sizer,"mouseup",function(){document.activeElement==d.input&&d.input.blur();ba(q)});var h;try{h=document.activeElement==c.input}catch(m){}h||b.autofocus&&!cc?setTimeout(ga(Da,this),20):fc(this);A(this,function(){for(var a in Qa)if(Qa.propertyIsEnumerable(a))Qa[a](this,
b[a],Oc);for(a=0;a<hc.length;++a)hc[a](this)})()}function x(a){a.doc.mode=k.getMode(a.options,a.doc.modeOption);a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null)});a.doc.frontier=a.doc.first;L(a,100);a.state.modeGen++;a.curOp&&S(a)}function t(a){var b=Y(a.display),c=a.options.lineWrapping,e=c&&Math.max(5,a.display.scroller.clientWidth/Ra(a.display)-3);return function(g){return Ea(a.doc,g)?0:c?(Math.ceil(g.text.length/e)||1)*b:b}}function u(a){var b=a.doc,c=t(a);b.iter(function(a){var b=
c(a);b!=a.height&&la(a,b)})}function r(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-");ja(a)}function p(a){j(a);S(a)}function j(a){var b=a.display.gutters,c=a.options.gutters;xb(b);for(var e=0;e<c.length;++e){var g=c[e],l=b.appendChild(C("div",null,"CodeMirror-gutter "+g));"CodeMirror-linenumbers"==g&&(a.display.lineGutter=l,l.style.width=(a.display.lineNumWidth||1)+"px")}b.style.display=e?"":"none"}function d(a,
b){if(0==b.height)return 0;for(var c=b.text.length,e,g=b;e=Fa(g,-1);)e=e.find(),g=D(a,e.from.line),c+=e.from.ch-e.to.ch;for(g=b;e=hb(g);)e=e.find(),c-=g.text.length-e.from.ch,g=D(a,e.to.line),c+=g.text.length-e.to.ch;return c}function m(a){var b=a.display,c=a.doc;b.maxLine=D(c,c.first);b.maxLineLength=d(c,b.maxLine);b.maxLineChanged=!0;c.iter(function(a){var g=d(c,a);g>b.maxLineLength&&(b.maxLineLength=g,b.maxLine=a)})}function f(a){for(var b=!1,c=0;c<a.gutters.length;++c)"CodeMirror-linenumbers"==
a.gutters[c]&&(a.lineNumbers?b=!0:a.gutters.splice(c--,1));!b&&a.lineNumbers&&a.gutters.push("CodeMirror-linenumbers")}function h(a,b){var c=b+(a.mover.offsetHeight-a.lineSpace.offsetHeight);a.sizer.style.minHeight=a.heightForcer.style.top=c+"px";var c=Math.max(c,a.scroller.scrollHeight),e=a.scroller.scrollWidth>a.scroller.clientWidth,g=c>a.scroller.clientHeight;g?(a.scrollbarV.style.display="block",a.scrollbarV.style.bottom=e?yb(a.measure)+"px":"0",a.scrollbarV.firstChild.style.height=c-a.scroller.clientHeight+
a.scrollbarV.clientHeight+"px"):a.scrollbarV.style.display="";e?(a.scrollbarH.style.display="block",a.scrollbarH.style.right=g?yb(a.measure)+"px":"0",a.scrollbarH.firstChild.style.width=a.scroller.scrollWidth-a.scroller.clientWidth+a.scrollbarH.clientWidth+"px"):a.scrollbarH.style.display="";e&&g?(a.scrollbarFiller.style.display="block",a.scrollbarFiller.style.height=a.scrollbarFiller.style.width=yb(a.measure)+"px"):a.scrollbarFiller.style.display="";Od&&0===yb(a.measure)&&(a.scrollbarV.style.minWidth=
a.scrollbarH.style.minHeight=Pd?"18px":"12px")}function y(a,b,c){var e=a.scroller.scrollTop,g=a.wrapper.clientHeight;"number"==typeof c?e=c:c&&(e=c.top,g=c.bottom-c.top);e=Math.floor(e-a.lineSpace.offsetTop);a=Math.ceil(e+g);return{from:zb(b,e),to:zb(b,a)}}function w(a){var b=a.display;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var c=n(b)-b.scroller.scrollLeft+a.doc.scrollLeft,e=b.gutters.offsetWidth,g=c+"px",l=b.lineDiv.firstChild;l;l=l.nextSibling)if(l.alignable)for(var q=
0,d=l.alignable;q<d.length;++q)d[q].style.left=g;a.options.fixedGutter&&(b.gutters.style.left=c+e+"px")}}function n(a){return Q(a.scroller).left-Q(a.sizer).left}function s(a,b,c){for(var e=a.display.showingFrom,g=a.display.showingTo,l,q=y(a.display,a.doc,c);;){if(E(a,b,q))l=!0,ma(a,"update",a),(a.display.showingFrom!=e||a.display.showingTo!=g)&&ma(a,"viewportChange",a,a.display.showingFrom,a.display.showingTo);else break;aa(a);h(a.display,a.doc.height);c&&(c=Math.min(a.display.scroller.scrollHeight-
a.display.scroller.clientHeight,"number"==typeof c?c:c.top));q=y(a.display,a.doc,c);if(q.from>=a.display.showingFrom&&q.to<=a.display.showingTo)break;b=[]}return l}function E(a,b,c){var e=a.display,g=a.doc;if(e.wrapper.clientWidth){if(!(0==b.length&&c.from>e.showingFrom&&c.to<e.showingTo)){var l;if(a.options.lineNumbers){l=a.doc;l=String(a.options.lineNumberFormatter(l.first+l.size-1+a.options.firstLineNumber));var q=a.display;if(l.length!=q.lineNumChars){var d=q.measure.appendChild(C("div",[C("div",
l)],"CodeMirror-linenumber CodeMirror-gutter-elt")),v=d.firstChild.offsetWidth,d=d.offsetWidth-v;q.lineGutter.style.width="";q.lineNumInnerWidth=Math.max(v,q.lineGutter.offsetWidth-d);q.lineNumWidth=q.lineNumInnerWidth+d;q.lineNumChars=q.lineNumInnerWidth?l.length:-1;q.lineGutter.style.width=q.lineNumWidth+"px";l=!0}else l=!1}else l=!1;l&&(b=[{from:g.first,to:g.first+g.size}]);l=e.sizer.style.marginLeft=e.gutters.offsetWidth+"px";e.scrollbarH.style.left=a.options.fixedGutter?l:"0";q=Infinity;if(a.options.lineNumbers)for(v=
0;v<b.length;++v)if(b[v].diff){q=b[v].from;break}v=g.first+g.size;l=Math.max(c.from-a.options.viewportMargin,g.first);c=Math.min(v,c.to+a.options.viewportMargin);e.showingFrom<l&&20>l-e.showingFrom&&(l=Math.max(g.first,e.showingFrom));e.showingTo>c&&20>e.showingTo-c&&(c=Math.min(v,e.showingTo));if(ib)for(l=da(Sa(g,D(g,l)));c<v&&Ea(g,D(g,c));)++c;d=[{from:Math.max(e.showingFrom,g.first),to:Math.min(e.showingTo,v)}];if(d[0].from>=d[0].to)d=[];else{for(var v=d,d=0,j=b.length||0;d<j;++d){for(var f=b[d],
h=[],m=f.diff||0,k=0,s=v.length;k<s;++k){var p=v[k];f.to<=p.from&&f.diff?h.push({from:p.from+m,to:p.to+m}):f.to<=p.from||f.from>=p.to?h.push(p):(f.from>p.from&&h.push({from:p.from,to:f.from}),f.to<p.to&&h.push({from:f.to+m,to:p.to+m}))}v=h}d=v}if(ib)for(v=0;v<d.length;++v)for(b=d[v];j=hb(D(g,b.to-1));)if(j=j.find().from.line,j>b.from)b.to=j;else{d.splice(v--,1);break}for(v=g=0;v<d.length;++v)b=d[v],b.from<l&&(b.from=l),b.to>c&&(b.to=c),b.from>=b.to?d.splice(v--,1):g+=b.to-b.from;if(g==c-l&&l==e.showingFrom&&
c==e.showingTo)Ga(a);else{d.sort(function(a,b){return a.from-b.from});try{var y=document.activeElement}catch(E){}g<0.7*(c-l)&&(e.lineDiv.style.display="none");g=l;b=c;for(var w=d,K=q,r=function(b){var c=b.nextSibling;fa&&Ta&&a.display.currentWheelTarget==b?(b.style.display="none",b.lineObj=null):b.parentNode.removeChild(b);return c},J,q=a.display,v={},d={},j=q.gutters.firstChild,f=0;j;j=j.nextSibling,++f)v[a.options.gutters[f]]=j.offsetLeft,d[a.options.gutters[f]]=j.offsetWidth;J={fixedPos:n(q),gutterTotalWidth:q.gutters.offsetWidth,
gutterLeft:v,gutterWidth:d,wrapperWidth:q.wrapper.clientWidth};var q=a.display,t=a.options.lineNumbers;!w.length&&(!fa||!a.display.currentWheelTarget)&&xb(q.lineDiv);var u=q.lineDiv,A=u.firstChild,x=w.shift(),z=g;for(a.doc.iter(g,b,function(b){x&&x.to==z&&(x=w.shift());if(Ea(a.doc,b)){if(0!=b.height&&la(b,0),b.widgets&&A.previousSibling)for(var c=0;c<b.widgets.length;++c)if(b.widgets[c].showIfHidden){var e=A.previousSibling;if(/pre/i.test(e.nodeName)){var g=C("div",null,null,"position: relative");
e.parentNode.replaceChild(g,e);g.appendChild(e);e=g}g=e.appendChild(C("div",[b.widgets[c].node],"CodeMirror-linewidget"));M(b.widgets[c],g,e,J)}}else if(x&&x.from<=z&&x.to>z){for(;A.lineObj!=b;)A=r(A);t&&(K<=z&&A.lineNumber)&&Pc(A.lineNumber,String(a.options.lineNumberFormatter(z+a.options.firstLineNumber)));A=A.nextSibling}else{if(b.widgets)for(var l=0,q=A;q&&20>l;++l,q=q.nextSibling)if(q.lineObj==b&&/div/i.test(q.nodeName)){c=q;break}var d=z,q=c,l=ic(a,b),v=b.gutterMarkers,Ba=a.display;if(!a.options.lineNumbers&&
!v&&!b.bgClass&&!b.wrapClass&&!b.widgets)e=l;else{if(q){q.alignable=null;for(var j=!0,f=0,wa=q.firstChild,h;wa;wa=h)if(h=wa.nextSibling,/\bCodeMirror-linewidget\b/.test(wa.className)){for(var m=0,n=!0;m<b.widgets.length;++m){var k=b.widgets[m],p=!1;k.above||(p=n,n=!1);if(k.node==wa.firstChild){M(k,wa,q,J);++f;p&&q.insertBefore(l,wa);break}}if(m==b.widgets.length){j=!1;break}}else q.removeChild(wa);j&&f==b.widgets.length&&(e=q,q.className=b.wrapClass||"")}e||(e=C("div",null,b.wrapClass,"position: relative"),
e.appendChild(l));b.bgClass&&e.insertBefore(C("div",null,b.bgClass+" CodeMirror-linebackground"),e.firstChild);if(a.options.lineNumbers||v){g=e.insertBefore(C("div",null,null,"position: absolute; left: "+(a.options.fixedGutter?J.fixedPos:-J.gutterTotalWidth)+"px"),e.firstChild);a.options.fixedGutter&&(e.alignable||(e.alignable=[])).push(g);if(a.options.lineNumbers&&(!v||!v["CodeMirror-linenumbers"]))e.lineNumber=g.appendChild(C("div",String(a.options.lineNumberFormatter(d+a.options.firstLineNumber)),
"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+J.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+Ba.lineNumInnerWidth+"px"));if(v)for(m=0;m<a.options.gutters.length;++m)k=a.options.gutters[m],(d=v.hasOwnProperty(k)&&v[k])&&g.appendChild(C("div",[d],"CodeMirror-gutter-elt","left: "+J.gutterLeft[k]+"px; width: "+J.gutterWidth[k]+"px"))}Na&&(e.style.zIndex=2);if(b.widgets&&e!=q){m=0;for(q=b.widgets;m<q.length;++m)k=q[m],v=C("div",[k.node],"CodeMirror-linewidget"),M(k,v,e,J),k.above?e.insertBefore(v,
a.options.lineNumbers&&0!=b.height?g:l):e.appendChild(v),ma(k,"redraw")}}if(e!=c)u.insertBefore(e,A);else{for(;A!=c;)A=r(A);A=A.nextSibling}e.lineObj=b}++z});A;)A=r(A);e.lineDiv.style.display="";y&&(document.activeElement!=y&&y.offsetHeight)&&y.focus();if(l!=e.showingFrom||c!=e.showingTo||e.lastSizeC!=e.wrapper.clientHeight)e.lastSizeC=e.wrapper.clientHeight;e.showingFrom=l;e.showingTo=c;L(a,100);y=e.lineDiv.offsetTop;for(l=e.lineDiv.firstChild;l;l=l.nextSibling)if(l.lineObj&&(Na?(c=l.offsetTop+l.offsetHeight,
g=c-y,y=c):(g=Q(l),g=g.bottom-g.top),c=l.lineObj.height-g,2>g&&(g=Y(e)),0.0010<c||-0.0010>c))if(la(l.lineObj,g),g=l.lineObj.widgets)for(v=0;v<g.length;++v)g[v].height=g[v].node.offsetHeight;Ga(a);return!0}}}else e.showingFrom=e.showingTo=g.first,e.viewOffset=0}function Ga(a){var b=a.display.viewOffset=Ua(a,D(a.doc,a.display.showingFrom));a.display.mover.style.top=b+"px"}function M(a,b,c,e){a.noHScroll&&((c.alignable||(c.alignable=[])).push(b),c=e.wrapperWidth,b.style.left=e.fixedPos+"px",a.coverGutter||
(c-=e.gutterTotalWidth,b.style.paddingLeft=e.gutterTotalWidth+"px"),b.style.width=c+"px");a.coverGutter&&(b.style.zIndex=5,b.style.position="relative",a.noHScroll||(b.style.marginLeft=-e.gutterTotalWidth+"px"))}function aa(a){var b=a.display,c=N(a.doc.sel.from,a.doc.sel.to);if(c||a.options.showCursorWhenSelecting){var e=a.display,g=V(a,a.doc.sel.head,"div");e.cursor.style.left=g.left+"px";e.cursor.style.top=g.top+"px";e.cursor.style.height=Math.max(0,g.bottom-g.top)*a.options.cursorHeight+"px";e.cursor.style.display=
"";g.other?(e.otherCursor.style.display="",e.otherCursor.style.left=g.other.left+"px",e.otherCursor.style.top=g.other.top+"px",e.otherCursor.style.height=0.85*(g.other.bottom-g.other.top)+"px"):e.otherCursor.style.display="none"}else b.cursor.style.display=b.otherCursor.style.display="none";if(c)b.selectionDiv.style.display="none";else{var l=function(a,b,c,e){0>b&&(b=0);d.appendChild(C("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+b+"px; width: "+(null==c?v-a:c)+"px; height: "+
(e-b)+"px"))},e=function(b,c,e,g){var d=D(q,b),Ba=d.text.length,f=g?Infinity:-Infinity;var m=na(d),h=c||0,n=null==e?Ba:e,k=function(q,m,h){var n=Z(a,z(b,q),"div",d),k,p;q==m?(k=n,h=p=n.left):(k=Z(a,z(b,m-1),"div",d),"rtl"==h&&(h=n,n=k,k=h),h=n.left,p=k.right);3<k.top-n.top&&(l(h,n.top,null,n.bottom),h=j,n.bottom<k.top&&l(h,n.bottom,null,k.top));null==e&&m==Ba&&(p=v);null==c&&0==q&&(h=j);f=g?Math.min(k.top,f):Math.max(k.bottom,f);h<j+1&&(h=j);l(h,k.top,p-h,k.bottom)};if(m)for(var p=0;p<m.length;++p){var s=
m[p];if(s.from<n&&s.to>h||h==n&&s.to==h)k(Math.max(s.from,h),Math.min(s.to,n),1==s.level?"rtl":"ltr")}else k(h,n,"ltr");return f},c=a.display,q=a.doc,g=a.doc.sel,d=document.createDocumentFragment(),v=c.lineSpace.offsetWidth,j=oa(a.display.measure,C("pre",null,null,"text-align: left")).appendChild(C("span","x")).offsetLeft;if(g.from.line==g.to.line)e(g.from.line,g.from.ch,g.to.ch);else{for(var f=D(q,g.from.line),m=f,h=[g.from.line,g.from.ch],n;m=hb(m);){m=m.find();h.push(m.from.ch,m.to.line,m.to.ch);
if(m.to.line==g.to.line){h.push(g.to.ch);n=!0;break}m=D(q,m.to.line)}if(n)for(n=0;n<h.length;n+=3)e(h[n],h[n+1],h[n+2]);else h=D(q,g.to.line),n=g.from.ch?e(g.from.line,g.from.ch,null,!1):Ua(a,f)-c.viewOffset,e=g.to.ch?e(g.to.line,Fa(h,-1)?null:0,g.to.ch,!0):Ua(a,h)-c.viewOffset,n<e&&l(j,n,null,e)}oa(c.selectionDiv,d);c.selectionDiv.style.display=""}a.options.moveInputWithCursor&&(c=V(a,a.doc.sel.head,"div"),e=Q(b.wrapper),n=Q(b.lineDiv),b.inputDiv.style.top=Math.max(0,Math.min(b.wrapper.clientHeight-
10,c.top+n.top-e.top))+"px",b.inputDiv.style.left=Math.max(0,Math.min(b.wrapper.clientWidth-10,c.left+n.left-e.left))+"px")}function G(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursor.style.visibility=b.otherCursor.style.visibility="";b.blinker=setInterval(function(){b.cursor.style.visibility=b.otherCursor.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate)}}function L(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.showingTo&&a.state.highlight.set(b,
ga(B,a))}function B(a){var b=a.doc;b.frontier<b.first&&(b.frontier=b.first);if(!(b.frontier>=a.display.showingTo)){var c=+new Date+a.options.workTime,e=Va(b.mode,O(a,b.frontier)),g=[],l;b.iter(b.frontier,Math.min(b.first+b.size,a.display.showingTo+500),function(q){if(b.frontier>=a.display.showingFrom){var d=q.styles;q.styles=Qc(a,q,e);for(var v=!d||d.length!=q.styles.length,j=0;!v&&j<d.length;++j)v=d[j]!=q.styles[j];v&&(l&&l.end==b.frontier?l.end++:g.push(l={start:b.frontier,end:b.frontier+1}));q.stateAfter=
Va(b.mode,e)}else Rc(a,q,e),q.stateAfter=0==b.frontier%5?Va(b.mode,e):null;++b.frontier;if(+new Date>c)return L(a,a.options.workDelay),!0});g.length&&A(a,function(){for(var a=0;a<g.length;++a)S(this,g[a].start,g[a].end)})()}}function O(a,b){var c=a.doc,e=a.display;if(!c.mode.startState)return!0;var g;a:{for(var l,q,d=a.doc,v=b,j=b-100;v>j;--v){if(v<=d.first){g=d.first;break a}var h=D(d,v-1);if(h.stateAfter){g=v;break a}h=Wa(h.text,null,a.options.tabSize);if(null==q||l>h)q=v-1,l=h}g=q}var f=g>c.first&&
D(c,g-1).stateAfter,f=f?Va(c.mode,f):Sc(c.mode);c.iter(g,b,function(l){Rc(a,l,f);l.stateAfter=g==b-1||0==g%5||g>=e.showingFrom&&g<e.showingTo?Va(c.mode,f):null;++g});return f}function K(a,b,c,e){var g=-1;e=e||Ha(a,b);for(a=c;;a+=g){var l=e[a];if(l)break;0>g&&0==a&&(g=1)}return{left:a<c?l.right:l.left,right:a>c?l.left:l.right,top:l.top,bottom:l.bottom}}function J(a,b){for(var c=a.display.measureLineCache,e=0;e<c.length;++e){var g=c[e];if(g.text==b.text&&g.markedSpans==b.markedSpans&&a.display.scroller.clientWidth==
g.width&&g.classes==b.textClass+"|"+b.bgClass+"|"+b.wrapClass)return g.measure}}function Ha(a,b){var c=J(a,b);if(!c){var e=a.display,g=Tc(b.text.length),l=ic(a,b,g);if(R&&!Na&&!a.options.lineWrapping&&100<l.childNodes.length){for(var q=document.createDocumentFragment(),d=l.childNodes.length,c=0,v=Math.ceil(d/10);c<v;++c){for(var j=C("div",null,null,"display: inline-block"),h=0;10>h&&d;++h)j.appendChild(l.firstChild),--d;q.appendChild(j)}l.appendChild(q)}oa(e.measure,l);v=Q(e.lineDiv);q=[];d=Tc(b.text.length);
j=l.offsetHeight;ha&&e.measure.first!=l&&oa(e.measure,l);for(c=0;c<g.length;++c)if(e=g[c]){for(var l=Q(e),f=Math.max(0,l.top-v.top),m=Math.min(l.bottom-v.top,j),h=0;h<q.length;h+=2){var n=q[h],k=q[h+1];if(!(n>m||k<f))if(n<=f&&k>=m||f<=n&&m>=k||Math.min(m,k)-Math.max(f,n)>=m-f>>1){q[h]=Math.min(f,n);q[h+1]=Math.max(m,k);break}}h==q.length&&q.push(f,m);f=l.right;e.measureRight&&(f=Q(e.measureRight).left);d[c]={left:l.left-v.left,right:f-v.left,top:h}}for(c=0;c<d.length;++c)if(e=d[c])g=e.top,e.top=q[g],
e.bottom=q[g+1];c=d;g=a.display.measureLineCache;h={text:b.text,width:a.display.scroller.clientWidth,markedSpans:b.markedSpans,measure:c,classes:b.textClass+"|"+b.bgClass+"|"+b.wrapClass};16==g.length?g[++a.display.measureLineCachePos%16]=h:g.push(h)}return c}function ja(a){a.display.measureLineCache.length=a.display.measureLineCachePos=0;a.display.cachedCharWidth=a.display.cachedTextHeight=null;a.options.lineWrapping||(a.display.maxLineChanged=!0);a.display.lineNumChars=null}function jb(a,b,c,e){if(b.widgets)for(var g=
0;g<b.widgets.length;++g)if(b.widgets[g].above){var l=Ab(b.widgets[g]);c.top+=l;c.bottom+=l}if("line"==e)return c;e||(e="local");b=Ua(a,b);"local"!=e&&(b-=a.display.viewOffset);"page"==e&&(a=Q(a.display.lineSpace),b+=a.top+(window.pageYOffset||(document.documentElement||document.body).scrollTop),a=a.left+(window.pageXOffset||(document.documentElement||document.body).scrollLeft),c.left+=a,c.right+=a);c.top+=b;c.bottom+=b;return c}function Z(a,b,c,e){e||(e=D(a.doc,b.line));return jb(a,e,K(a,e,b.ch),
c)}function V(a,b,c,e,g){function l(b,l){var q=K(a,e,b,g);l?q.left=q.right:q.right=q.left;return jb(a,e,q,c)}e=e||D(a.doc,b.line);g||(g=Ha(a,e));var q=na(e);b=b.ch;if(!q)return l(b);for(var d,v,j=q[0].level,h=0;h<q.length;++h){var f=q[h],m=f.level%2,n;if(f.from<b&&f.to>b)return l(b,m);var k=m?f.from:f.to;if((m?f.to:f.from)==b)f=h&&f.level<(n=q[h-1]).level?l(n.level%2?n.from:n.to-1,!0):l(m&&f.from!=f.to?b-1:b),m==j?d=f:v=f;else if(k==b&&(n=h<q.length-1&&q[h+1],m||!(n&&n.from==n.to)))f=n&&f.level<n.level?
l(n.level%2?n.to-1:n.from):l(m?b:b-1,!0),m==j?d=f:v=f}j&&!b&&(v=l(q[0].to-1));if(!d)return v;v&&(d.other=v);return d}function pa(a,b,c){a=new z(a,b);c&&(a.outside=!0);return a}function ea(a,b,c){var e=a.doc;c+=a.display.viewOffset;if(0>c)return pa(e.first,0,!0);var g=zb(e,c),l=e.first+e.size-1;if(g>l)return pa(e.first+e.size-1,D(e,l).text.length,!0);for(0>b&&(b=0);;){var l=D(e,g),g=sa(a,l,g,b,c),q=(l=hb(l))&&l.find();if(l&&g.ch>=q.from.ch)g=q.to.line;else return g}}function sa(a,b,c,e,g){function l(e){e=
V(a,z(c,e),"line",b,f);d=!0;if(q>e.bottom)return e.left-v;if(q<e.top)return e.left+v;d=!1;return e.left}var q=g-Ua(a,b),d=!1,v=2*a.display.wrapper.clientWidth,f=Ha(a,b),h=na(b),j=b.text.length,m=Bb(b),n=Cb(b),k=l(m);g=d;var p=l(n),s=d;if(e>p)return pa(c,n,s);for(;;){if(h?n==m||n==jc(b,m,1):1>=n-m){for(m=(e=e-k<p-e)?m:n;kc.test(b.text.charAt(m));)++m;g=pa(c,m,e?g:s);g.after=e;return g}var y=Math.ceil(j/2),E=m+y;if(h)for(var E=m,w=0;w<y;++w)E=jc(b,E,1);w=l(E);if(w>e){n=E;p=w;if(s=d)p+=1E3;j=y}else m=
E,k=w,g=d,j-=y}}function Y(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==Ia){Ia=C("pre");for(var b=0;49>b;++b)Ia.appendChild(document.createTextNode("x")),Ia.appendChild(C("br"));Ia.appendChild(document.createTextNode("x"))}oa(a.measure,Ia);b=Ia.offsetHeight/50;3<b&&(a.cachedTextHeight=b);xb(a.measure);return b||1}function Ra(a){if(null!=a.cachedCharWidth)return a.cachedCharWidth;var b=C("span","x"),c=C("pre",[b]);oa(a.measure,c);b=b.offsetWidth;2<b&&(a.cachedCharWidth=b);return b||
10}function qa(a){a.curOp={changes:[],updateInput:null,userSelChange:null,textChanged:null,selectionChanged:!1,cursorActivity:!1,updateMaxLine:!1,updateScrollPos:!1,id:++Qd};Db++||(xa=[])}function ya(a){var b=a.curOp,c=a.doc,e=a.display;a.curOp=null;b.updateMaxLine&&m(a);if(e.maxLineChanged&&!a.options.lineWrapping&&e.maxLine){var g;g=e.maxLine;var l=!1;if(g.markedSpans)for(var q=0;q<g.markedSpans;++q){var d=g.markedSpans[q];if(d.collapsed&&(null==d.to||d.to==g.text.length))l=!0}(l=!l&&J(a,g))?g=
K(a,g,g.text.length,l).right:(g=ic(a,g),l=g.appendChild(Eb(a.display.measure)),oa(a.display.measure,g),g=Q(l).right-Q(a.display.lineDiv).left);e.sizer.style.minWidth=Math.max(0,g+3+cb)+"px";e.maxLineChanged=!1;g=Math.max(0,e.sizer.offsetLeft+e.sizer.offsetWidth-e.scroller.clientWidth);g<c.scrollLeft&&!b.updateScrollPos&&Pa(a,Math.min(e.scroller.scrollLeft,g),!0)}var v,f;b.updateScrollPos?v=b.updateScrollPos:b.selectionChanged&&e.scroller.clientHeight&&(v=V(a,c.sel.head),v=Fb(a,v.left,v.top,v.left,
v.bottom));if(b.changes.length||v&&null!=v.scrollTop)f=s(a,b.changes,v&&v.scrollTop),a.display.scroller.offsetHeight&&(a.doc.scrollTop=a.display.scroller.scrollTop);!f&&b.selectionChanged&&aa(a);if(b.updateScrollPos)e.scroller.scrollTop=e.scrollbarV.scrollTop=c.scrollTop=v.scrollTop,e.scroller.scrollLeft=e.scrollbarH.scrollLeft=c.scrollLeft=v.scrollLeft,w(a),b.scrollToPos&&Uc(a,F(a.doc,b.scrollToPos),b.scrollToPosMargin);else if(v&&(c=Uc(a,a.doc.sel.head),a.state.focused)){e=a.display;v=Q(e.sizer);
f=null;g=a.display.lineSpace.offsetTop;if(0>c.top+g+v.top)f=!0;else if(c.bottom+g+v.top>(window.innerHeight||document.documentElement.clientHeight))f=!1;if(null!=f&&!Rd){if(v="none"==e.cursor.style.display)e.cursor.style.display="",e.cursor.style.left=c.left+"px",e.cursor.style.top=c.top-e.viewOffset+"px";e.cursor.scrollIntoView(f);v&&(e.cursor.style.display="none")}}b.selectionChanged&&G(a);a.state.focused&&b.updateInput&&va(a,b.userSelChange);c=b.maybeHiddenMarkers;e=b.maybeUnhiddenMarkers;if(c)for(f=
0;f<c.length;++f)c[f].lines.length||X(c[f],"hide");if(e)for(f=0;f<e.length;++f)e[f].lines.length&&X(e[f],"unhide");var h;--Db||(h=xa,xa=null);b.textChanged&&X(a,"change",a,b.textChanged);b.cursorActivity&&X(a,"cursorActivity",a);if(h)for(f=0;f<h.length;++f)h[f]()}function A(a,b){return function(){var c=a||this,e=!c.curOp;e&&qa(c);try{var g=b.apply(c,arguments)}finally{e&&ya(c)}return g}}function kb(a){return function(){var b=this.cm&&!this.cm.curOp,c;b&&qa(this.cm);try{c=a.apply(this,arguments)}finally{b&&
ya(this.cm)}return c}}function Ic(a,b){var c=!a.curOp,e;c&&qa(a);try{e=b()}finally{c&&ya(a)}return e}function S(a,b,c,e){null==b&&(b=a.doc.first);null==c&&(c=a.doc.first+a.doc.size);a.curOp.changes.push({from:b,to:c,diff:e})}function Gb(a){a.display.pollingFast||a.display.poll.set(a.options.pollInterval,function(){lc(a);a.state.focused&&Gb(a)})}function gb(a){function b(){!lc(a)&&!c?(c=!0,a.display.poll.set(60,b)):(a.display.pollingFast=!1,Gb(a))}var c=!1;a.display.pollingFast=!0;a.display.poll.set(20,
b)}function lc(a){var b=a.display.input,c=a.display.prevInput,e=a.doc,g=e.sel;if(!a.state.focused||Sd(b)||lb(a))return!1;var l=b.value;if(l==c&&N(g.from,g.to))return!1;if(R&&!ha&&a.display.inputHasSelection===l)return va(a,!0),!1;var q=!a.curOp;q&&qa(a);g.shift=!1;for(var d=0,f=Math.min(c.length,l.length);d<f&&c.charCodeAt(d)==l.charCodeAt(d);)++d;f=g.from;g=g.to;d<c.length?f=z(f.line,f.ch-(c.length-d)):a.state.overwrite&&(N(f,g)&&!a.state.pasteIncoming)&&(g=z(g.line,Math.min(D(e,g.line).text.length,
g.ch+(l.length-d))));c=a.curOp.updateInput;Xa(a.doc,{from:f,to:g,text:Ja(l.slice(d)),origin:a.state.pasteIncoming?"paste":"+input"},"end");a.curOp.updateInput=c;1E3<l.length||-1<l.indexOf("\n")?b.value=a.display.prevInput="":a.display.prevInput=l;q&&ya(a);a.state.pasteIncoming=!1;return!0}function va(a,b){var c,e,g=a.doc;N(g.sel.from,g.sel.to)?b&&(a.display.prevInput=a.display.input.value="",R&&!ha&&(a.display.inputHasSelection=null)):(a.display.prevInput="",e=(c=Hb&&(100<g.sel.to.line-g.sel.from.line||
1E3<(e=a.getSelection()).length))?"-":e||a.getSelection(),a.display.input.value=e,a.state.focused&&Jc(a.display.input),R&&!ha&&(a.display.inputHasSelection=e));a.display.inaccurateSelection=c}function ba(a){"nocursor"!=a.options.readOnly&&(!cc||document.activeElement!=a.display.input)&&a.display.input.focus()}function lb(a){return a.options.readOnly||a.doc.cantEdit}function Ca(a,b){for(var c=b.target||b.srcElement;c!=a.wrapper;c=c.parentNode)if(!c||/\bCodeMirror-(?:line)?widget\b/.test(c.className)||
c.parentNode==a.sizer&&c!=a.mover)return!0}function Oa(a,b,c){var e=a.display;if(!c&&(c=b.target||b.srcElement,c==e.scrollbarH||c==e.scrollbarH.firstChild||c==e.scrollbarV||c==e.scrollbarV.firstChild||c==e.scrollbarFiller))return null;var g,l,e=Q(e.lineSpace);try{g=b.clientX,l=b.clientY}catch(q){return null}return ea(a,g-e.left,l-e.top)}function Ld(a){function b(a){if(!N(E,a))if(E=a,"single"==j)U(g.doc,F(q,f),a);else if(p=F(q,p),s=F(q,s),"double"==j){var b=dc(D(q,a.line).text,a);P(a,p)?U(g.doc,b.from,
s):U(g.doc,p,b.to)}else"triple"==j&&(P(a,p)?U(g.doc,s,F(q,z(a.line,0))):U(g.doc,p,F(q,z(a.line+1,0))))}function c(a){var e=++K,d=Oa(g,a,!0);if(d)if(N(d,n)){var f=a.clientY<w.top?-20:a.clientY>w.bottom?20:0;f&&setTimeout(A(g,function(){K==e&&(l.scroller.scrollTop+=f,c(a))}),50)}else{g.state.focused||Da(g);n=d;b(d);var h=y(l,q);(d.line>=h.to||d.line<h.from)&&setTimeout(A(g,function(){K==e&&c(a)}),150)}}function e(a){K=Infinity;var c=Oa(g,a);c&&b(c);T(a);ba(g);ra(document,"mousemove",r);ra(document,
"mouseup",J)}var g=this,l=g.display,q=g.doc,d=q.sel;d.shift=a.shiftKey;if(Ca(l,a))fa||(l.scroller.draggable=!1,setTimeout(function(){l.scroller.draggable=!0},100));else if(!Kc(g,a)){var f=Oa(g,a);switch(Vc(a)){case 3:ec&&Lc.call(g,g,a);return;case 2:f&&U(g.doc,f);setTimeout(ga(ba,g),20);T(a);return}if(f){g.state.focused||Da(g);var h=+new Date,j="single";if(Ib&&Ib.time>h-400&&N(Ib.pos,f)){j="triple";T(a);setTimeout(ga(ba,g),20);var h=g,m=f.line;U(h.doc,z(m,0),F(h.doc,z(m+1,0)))}else Jb&&Jb.time>h-
400&&N(Jb.pos,f)?(j="double",Ib={time:h,pos:f},T(a),h=dc(D(q,f.line).text,f),U(g.doc,h.from,h.to)):Jb={time:h,pos:f};var n=f;if(g.options.dragDrop&&mc&&!lb(g)&&!N(d.from,d.to)&&!P(f,d.from)&&!P(d.to,f)&&"single"==j){var k=A(g,function(b){fa&&(l.scroller.draggable=!1);g.state.draggingText=!1;ra(document,"mouseup",k);ra(l.scroller,"drop",k);10>Math.abs(a.clientX-b.clientX)+Math.abs(a.clientY-b.clientY)&&(T(b),U(g.doc,f),ba(g))});fa&&(l.scroller.draggable=!0);g.state.draggingText=k;l.scroller.dragDrop&&
l.scroller.dragDrop();H(document,"mouseup",k);H(l.scroller,"drop",k)}else{T(a);"single"==j&&U(g.doc,F(q,f));var p=d.from,s=d.to,E=f,w=Q(l.wrapper),K=0,r=A(g,function(a){!R&&!Vc(a)?e(a):c(a)}),J=A(g,e);H(document,"mousemove",r);H(document,"mouseup",J)}}else(a.target||a.srcElement)==l.scroller&&T(a)}}function Nd(a){var b=this;if(!(Ca(b.display,a)||b.options.onDragEvent&&b.options.onDragEvent(b,db(a)))){T(a);var c=Oa(b,a,!0),e=a.dataTransfer.files;if(c&&!lb(b))if(e&&e.length&&window.FileReader&&window.File){var g=
e.length,l=Array(g),q=0;a=function(a,e){var d=new FileReader;d.onload=function(){l[e]=d.result;++q==g&&(c=F(b.doc,c),Xa(b.doc,{from:c,to:c,text:Ja(l.join("\n")),origin:"paste"},"around"))};d.readAsText(a)};for(var d=0;d<g;++d)a(e[d],d)}else if(b.state.draggingText&&!P(c,b.doc.sel.from)&&!P(b.doc.sel.to,c))b.state.draggingText(a),setTimeout(ga(ba,b),20);else try{if(l=a.dataTransfer.getData("Text")){var d=b.doc.sel.from,f=b.doc.sel.to;za(b.doc,c,c);b.state.draggingText&&Aa(b.doc,"",d,f,"paste");b.replaceSelection(l,
null,"paste");ba(b);Da(b)}}catch(h){}}}function Kc(a,b){var c=a.display;try{var e=b.clientX,g=b.clientY}catch(l){return!1}if(e>=Math.floor(Q(c.gutters).right))return!1;T(b);if(!Ya(a,"gutterClick"))return!0;var d=Q(c.lineDiv);if(g>d.bottom)return!0;g-=d.top-c.viewOffset;for(d=0;d<a.options.gutters.length;++d){var f=c.gutters.childNodes[d];if(f&&Q(f).right>=e){c=zb(a.doc,g);ma(a,"gutterClick",a,c,a.options.gutters[d],b);break}}return!0}function fb(a,b){2>Math.abs(a.doc.scrollTop-b)||(a.doc.scrollTop=
b,Za||s(a,[],b),a.display.scroller.scrollTop!=b&&(a.display.scroller.scrollTop=b),a.display.scrollbarV.scrollTop!=b&&(a.display.scrollbarV.scrollTop=b),Za&&s(a,[]))}function Pa(a,b,c){if(!(c?b==a.doc.scrollLeft:2>Math.abs(a.doc.scrollLeft-b)))b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth),a.doc.scrollLeft=b,w(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbarH.scrollLeft!=b&&(a.display.scrollbarH.scrollLeft=b)}function Mc(a,b){var c=
b.wheelDeltaX,e=b.wheelDeltaY;null==c&&(b.detail&&b.axis==b.HORIZONTAL_AXIS)&&(c=b.detail);null==e&&b.detail&&b.axis==b.VERTICAL_AXIS?e=b.detail:null==e&&(e=b.wheelDelta);var g=a.display,l=g.scroller;if(c&&l.scrollWidth>l.clientWidth||e&&l.scrollHeight>l.clientHeight){if(e&&Ta&&fa)for(var d=b.target;d!=l;d=d.parentNode)if(d.lineObj){a.display.currentWheelTarget=d;break}if(c&&!Za&&!ka&&null!=ia)e&&fb(a,Math.max(0,Math.min(l.scrollTop+e*ia,l.scrollHeight-l.clientHeight))),Pa(a,Math.max(0,Math.min(l.scrollLeft+
c*ia,l.scrollWidth-l.clientWidth))),T(b),g.wheelStartX=null;else{if(e&&null!=ia){var d=e*ia,f=a.doc.scrollTop,h=f+g.wrapper.clientHeight;0>d?f=Math.max(0,f+d-50):h=Math.min(a.doc.height,h+d+50);s(a,[],{top:f,bottom:h})}20>Kb&&(null==g.wheelStartX?(g.wheelStartX=l.scrollLeft,g.wheelStartY=l.scrollTop,g.wheelDX=c,g.wheelDY=e,setTimeout(function(){if(null!=g.wheelStartX){var a=l.scrollLeft-g.wheelStartX,b=l.scrollTop-g.wheelStartY,a=b&&g.wheelDY&&b/g.wheelDY||a&&g.wheelDX&&a/g.wheelDX;g.wheelStartX=
g.wheelStartY=null;a&&(ia=(ia*Kb+a)/(Kb+1),++Kb)}},200)):(g.wheelDX+=c,g.wheelDY+=e))}}}function Lb(a,b,c){if("string"==typeof b&&(b=nc[b],!b))return!1;a.display.pollingFast&&lc(a)&&(a.display.pollingFast=!1);var e=a.doc,g=e.sel.shift,l=!1;try{lb(a)&&(a.state.suppressEdits=!0),c&&(e.sel.shift=!1),l=b(a)!=Wc}finally{e.sel.shift=g,a.state.suppressEdits=!1}return l}function Xc(a){var b=a.state.keyMaps.slice(0);a.options.extraKeys&&b.push(a.options.extraKeys);b.push(a.options.keyMap);return b}function Yc(a,
b){var c=oc(a.options.keyMap),e=c.auto;clearTimeout(Zc);e&&!$c(b)&&(Zc=setTimeout(function(){oc(a.options.keyMap)==c&&(a.options.keyMap=e.call?e.call(null,a):e)},50));var g=ad(b,!0),l=!1;if(!g)return!1;l=Xc(a);l=b.shiftKey?mb("Shift-"+g,l,function(b){return Lb(a,b,!0)})||mb(g,l,function(b){if("string"==typeof b&&/^go[A-Z]/.test(b))return Lb(a,b)}):mb(g,l,function(b){return Lb(a,b)});"stop"==l&&(l=!1);l&&(T(b),G(a),ha&&(b.oldKeyCode=b.keyCode,b.keyCode=0));return l}function Nc(a){this.state.focused||
Da(this);R&&27==a.keyCode&&(a.returnValue=!1);if(!this.options.onKeyEvent||!this.options.onKeyEvent(this,db(a))){var b=a.keyCode;this.doc.sel.shift=16==b||a.shiftKey;var c=Yc(this,a);ka&&(pc=c?b:null,!c&&(88==b&&!Hb&&(Ta?a.metaKey:a.ctrlKey))&&this.replaceSelection(""))}}function Md(a){var b=this;if(!b.options.onKeyEvent||!b.options.onKeyEvent(b,db(a))){var c=a.keyCode,e=a.charCode;if(ka&&c==pc)pc=null,T(a);else if(!(ka&&(!a.which||10>a.which)||ac)||!Yc(b,a)){c=String.fromCharCode(null==e?c:e);this.options.electricChars&&
(this.doc.mode.electricChars&&this.options.smartIndent&&!lb(this)&&-1<this.doc.mode.electricChars.indexOf(c))&&setTimeout(A(b,function(){Mb(b,b.doc.sel.to.line,"smart")}),75);if(c=mb("'"+c+"'",Xc(b),function(a){return Lb(b,a,!0)}))T(a),G(b);c||(R&&!ha&&(b.display.inputHasSelection=null),gb(b))}}}function Da(a){"nocursor"!=a.options.readOnly&&(a.state.focused||(X(a,"focus",a),a.state.focused=!0,-1==a.display.wrapper.className.search(/\bCodeMirror-focused\b/)&&(a.display.wrapper.className+=" CodeMirror-focused"),
va(a,!0)),Gb(a),G(a))}function fc(a){a.state.focused&&(X(a,"blur",a),a.state.focused=!1,a.display.wrapper.className=a.display.wrapper.className.replace(" CodeMirror-focused",""));clearInterval(a.display.blinker);setTimeout(function(){a.state.focused||(a.doc.sel.shift=!1)},150)}function Lc(a,b){function c(){e.inputDiv.style.position="relative";e.input.style.cssText=f;ha&&(e.scrollbarV.scrollTop=e.scroller.scrollTop=d);Gb(a);if(null!=e.input.selectionStart&&(!R||ha)){clearTimeout(qc);var b=e.input.value=
" "+(N(g.from,g.to)?"":e.input.value),c=0;e.prevInput=" ";e.input.selectionStart=1;e.input.selectionEnd=b.length;var l=function(){" "==e.prevInput&&0==e.input.selectionStart?A(a,nc.selectAll)(a):10>c++?qc=setTimeout(l,500):va(a)};qc=setTimeout(l,200)}}var e=a.display,g=a.doc.sel;if(!Ca(e,b)){var l=Oa(a,b),d=e.scroller.scrollTop;if(l&&!ka){(N(g.from,g.to)||P(l,g.from)||!P(l,g.to))&&A(a,za)(a.doc,l,l);var f=e.input.style.cssText;e.inputDiv.style.position="absolute";e.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+
(b.clientY-5)+"px; left: "+(b.clientX-5)+"px; z-index: 1000; background: white; outline: none;border-width: 0; outline: none; overflow: hidden; opacity: .05; -ms-opacity: .05; filter: alpha(opacity=5);";ba(a);va(a,!0);N(g.from,g.to)&&(e.input.value=e.prevInput=" ");if(ec){eb(b);var h=function(){ra(window,"mouseup",h);setTimeout(c,20)};H(window,"mouseup",h)}else setTimeout(c,50)}}}function rc(a){return!a.text?a.to:z(a.from.line+a.text.length-1,$(a.text).length+(1==a.text.length?a.from.ch:0))}function bd(a,
b,c){if(!P(b.from,c))return F(a,c);var e=b.text.length-1-(b.to.line-b.from.line);if(c.line>b.to.line+e)return b=c.line-e,e=a.first+a.size-1,b>e?z(e,D(a,e).text.length):Nb(c,D(a,b).text.length);if(c.line==b.to.line+e)return Nb(c,$(b.text).length+(1==b.text.length?b.from.ch:0)+D(a,b.to.line).text.length-b.to.ch);a=c.line-b.from.line;return Nb(c,b.text[a].length+(a?0:b.from.ch))}function sc(a,b,c){if(c&&"object"==typeof c)return{anchor:bd(a,b,c.anchor),head:bd(a,b,c.head)};if("start"==c)return{anchor:b.from,
head:b.from};var e=rc(b);if("around"==c)return{anchor:b.from,head:e};if("end"==c)return{anchor:e,head:e};c=function(a){if(P(a,b.from))return a;if(!P(b.to,a))return e;var c=a.line+b.text.length-(b.to.line-b.from.line)-1,d=a.ch;a.line==b.to.line&&(d+=e.ch-b.to.ch);return z(c,d)};return{anchor:c(a.sel.anchor),head:c(a.sel.head)}}function Xa(a,b,c,e){if(a.cm){if(!a.cm.curOp)return A(a.cm,Xa)(a,b,c,e);if(a.cm.state.suppressEdits)return}if(Ya(a,"beforeChange")||a.cm&&Ya(a.cm,"beforeChange"))if(b={canceled:!1,
from:b.from,to:b.to,text:b.text,origin:b.origin,update:function(b,c,e,g){b&&(this.from=F(a,b));c&&(this.to=F(a,c));e&&(this.text=e);void 0!==g&&(this.origin=g)},cancel:function(){this.canceled=!0}},X(a,"beforeChange",a,b),a.cm&&X(a.cm,"beforeChange",a.cm,b),b=b.canceled?null:{from:b.from,to:b.to,text:b.text,origin:b.origin},!b)return;var g;if(g=cd){if(e=!e){e=b.from;g=b.to;var l=null;a.iter(e.line,g.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;
if(c.readOnly&&(!l||-1==ta(l,c)))(l||(l=[])).push(c)}});if(l){e=[{from:e,to:g}];for(g=0;g<l.length;++g)for(var d=l[g],f=d.find(),h=0;h<e.length;++h){var j=e[h];if(!P(j.to,f.from)&&!P(f.to,j.from)){var m=[h,1];(P(j.from,f.from)||!d.inclusiveLeft&&N(j.from,f.from))&&m.push({from:j.from,to:f.from});(P(f.to,j.to)||!d.inclusiveRight&&N(j.to,f.to))&&m.push({from:f.to,to:j.to});e.splice.apply(e,m);h+=m.length-1}}}else e=null}g=e}if(e=g){for(g=e.length-1;1<=g;--g)tc(a,{from:e[g].from,to:e[g].to,text:[""]});
e.length&&tc(a,{from:e[0].from,to:e[0].to,text:b.text},c)}else tc(a,b,c)}function tc(a,b,c){c=sc(a,b,c);dd(a,b,c,a.cm?a.cm.curOp.id:NaN);nb(a,b,c,uc(a,b));var e=[];$a(a,function(a,c){!c&&-1==ta(e,a.history)&&(ed(a.history,b),e.push(a.history));nb(a,b,null,uc(a,b))})}function fd(a,b){if(!a.cm||!a.cm.state.suppressEdits){var c=a.history,e=("undo"==b?c.done:c.undone).pop();if(e){c.dirtyCounter+="undo"==b?-1:1;var g={changes:[],anchorBefore:e.anchorAfter,headBefore:e.headAfter,anchorAfter:e.anchorBefore,
headAfter:e.headBefore};("undo"==b?c.undone:c.done).push(g);for(c=e.changes.length-1;0<=c;--c){var l=e.changes[c];l.origin=b;g.changes.push(vc(a,l));var d=c?sc(a,l,null):{anchor:e.anchorBefore,head:e.headBefore};nb(a,l,d,gd(a,l));var f=[];$a(a,function(a,b){!b&&-1==ta(f,a.history)&&(ed(a.history,l),f.push(a.history));nb(a,l,null,gd(a,l))})}}}}function hd(a,b){function c(a){return z(a.line+b,a.ch)}a.first+=b;a.cm&&S(a.cm,a.first,a.first,b);a.sel.head=c(a.sel.head);a.sel.anchor=c(a.sel.anchor);a.sel.from=
c(a.sel.from);a.sel.to=c(a.sel.to)}function nb(a,b,c,e){if(a.cm&&!a.cm.curOp)return A(a.cm,nb)(a,b,c,e);if(b.to.line<a.first)hd(a,b.text.length-1-(b.to.line-b.from.line));else if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var g=b.text.length-1-(a.first-b.from.line);hd(a,g);b={from:z(a.first,0),to:z(b.to.line+g,b.to.ch),text:[$(b.text)],origin:b.origin}}g=a.lastLine();b.to.line>g&&(b={from:b.from,to:z(g,D(a,g).text.length),text:[b.text[0]],origin:b.origin});b.removed=wc(a,b.from,b.to);c||
(c=sc(a,b,null));if(a.cm){a=a.cm;var l=a.doc,q=a.display,g=b.from,f=b.to,h=!1,j=g.line;a.options.lineWrapping||(j=da(Sa(l,D(l,g.line))),l.iter(j,f.line+1,function(a){if(a==q.maxLine)return h=!0}));!P(l.sel.head,b.from)&&!P(b.to,l.sel.head)&&(a.curOp.cursorActivity=!0);xc(l,b,e,c,t(a));a.options.lineWrapping||(l.iter(j,g.line+b.text.length,function(a){var b=d(l,a);b>q.maxLineLength&&(q.maxLine=a,q.maxLineLength=b,q.maxLineChanged=!0,h=!1)}),h&&(a.curOp.updateMaxLine=!0));l.frontier=Math.min(l.frontier,
g.line);L(a,400);S(a,g.line,f.line+1,b.text.length-(f.line-g.line)-1);if(Ya(a,"change"))if(e={from:g,to:f,text:b.text,removed:b.removed,origin:b.origin},a.curOp.textChanged){for(a=a.curOp.textChanged;a.next;a=a.next);a.next=e}else a.curOp.textChanged=e}else xc(a,b,e,c)}}function Aa(a,b,c,e,g){e||(e=c);if(P(e,c)){var l=e;e=c;c=l}"string"==typeof b&&(b=Ja(b));Xa(a,{from:c,to:e,text:b,origin:g},null)}function z(a,b){if(!(this instanceof z))return new z(a,b);this.line=a;this.ch=b}function N(a,b){return a.line==
b.line&&a.ch==b.ch}function P(a,b){return a.line<b.line||a.line==b.line&&a.ch<b.ch}function Ka(a){return z(a.line,a.ch)}function F(a,b){if(b.line<a.first)return z(a.first,0);var c=a.first+a.size-1;return b.line>c?z(c,D(a,c).text.length):Nb(b,D(a,b.line).text.length)}function Nb(a,b){var c=a.ch;return null==c||c>b?z(a.line,b):0>c?z(a.line,0):a}function ab(a,b){return b>=a.first&&b<a.first+a.size}function U(a,b,c,e){if(a.sel.shift||a.sel.extend){var g=a.sel.anchor;if(c){var l=P(b,g);l!=P(c,g)?(g=b,
b=c):l!=P(b,c)&&(b=c)}za(a,g,b,e)}else za(a,b,c||b,e);a.cm&&(a.cm.curOp.userSelChange=!0)}function za(a,b,c,e,g){if(!g&&Ya(a,"beforeSelectionChange")||a.cm&&Ya(a.cm,"beforeSelectionChange"))b={anchor:b,head:c},X(a,"beforeSelectionChange",a,b),a.cm&&X(a.cm,"beforeSelectionChange",a.cm,b),b.anchor=F(a,b.anchor),b.head=F(a,b.head),c=b.head,b=b.anchor;var l=a.sel;l.goalColumn=null;if(g||!N(b,l.anchor))b=Ob(a,b,e,"push"!=g);if(g||!N(c,l.head))c=Ob(a,c,e,"push"!=g);if(!N(l.anchor,b)||!N(l.head,c))l.anchor=
b,l.head=c,e=P(c,b),l.from=e?c:b,l.to=e?b:c,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=a.cm.curOp.cursorActivity=!0),ma(a,"cursorActivity",a)}function id(a){za(a.doc,a.doc.sel.from,a.doc.sel.to,null,"push")}function Ob(a,b,c,e){var g=!1,l=b,d=c||1;a.cantEdit=!1;a:for(;;){var f=D(a,l.line);if(f.markedSpans)for(var h=0;h<f.markedSpans.length;++h){var j=f.markedSpans[h],m=j.marker;if((null==j.from||(m.inclusiveLeft?j.from<=l.ch:j.from<l.ch))&&(null==j.to||(m.inclusiveRight?j.to>=l.ch:
j.to>l.ch))){if(e&&(X(m,"beforeCursorEnter"),m.explicitlyCleared))if(f.markedSpans){--h;continue}else break;if(m.atomic){h=m.find()[0>d?"from":"to"];if(N(h,l)&&(h.ch+=d,0>h.ch?h=h.line>a.first?F(a,z(h.line-1)):null:h.ch>f.text.length&&(h=h.line<a.first+a.size-1?z(h.line+1,0):null),!h)){if(g){if(!e)return Ob(a,b,c,!0);a.cantEdit=!0;return z(a.first,0)}g=!0;h=b;d=-d}l=h;continue a}}}return l}}function Uc(a,b,c){for(null==c&&(c=0);;){var e=!1,g=V(a,b),l=Fb(a,g.left,g.top-c,g.left,g.bottom+c),d=a.doc.scrollTop,
f=a.doc.scrollLeft;null!=l.scrollTop&&(fb(a,l.scrollTop),1<Math.abs(a.doc.scrollTop-d)&&(e=!0));null!=l.scrollLeft&&(Pa(a,l.scrollLeft),1<Math.abs(a.doc.scrollLeft-f)&&(e=!0));if(!e)return g}}function Fb(a,b,c,e,g){var l=a.display,d=l.lineSpace.offsetTop;c+=d;g+=d;0>c&&(c=0);var f=l.scroller.clientHeight-cb,h=l.scroller.scrollTop,j={};a=a.doc.height+(l.mover.offsetHeight-l.lineSpace.offsetHeight);var m=c<d+10,d=g+d>a-10;c<h?j.scrollTop=m?0:c:g>h+f&&(c=Math.min(c,(d?a:g)-f),c!=h&&(j.scrollTop=c));
h=l.scroller.clientWidth-cb;c=l.scroller.scrollLeft;b+=l.gutters.offsetWidth;e+=l.gutters.offsetWidth;l=l.gutters.offsetWidth;g=b<l+10;b<c+l||g?(g&&(b=0),j.scrollLeft=Math.max(0,b-10-l)):e>h+c-3&&(j.scrollLeft=e+10-h);return j}function Pb(a,b,c){a.curOp.updateScrollPos={scrollLeft:null==b?a.doc.scrollLeft:b,scrollTop:null==c?a.doc.scrollTop:c}}function jd(a,b,c){var e=a.curOp.updateScrollPos||(a.curOp.updateScrollPos={scrollLeft:a.doc.scrollLeft,scrollTop:a.doc.scrollTop});a=a.display.scroller;e.scrollTop=
Math.max(0,Math.min(a.scrollHeight-a.clientHeight,e.scrollTop+c));e.scrollLeft=Math.max(0,Math.min(a.scrollWidth-a.clientWidth,e.scrollLeft+b))}function Mb(a,b,c,e){var g=a.doc;c||(c="add");if("smart"==c)if(a.doc.mode.indent)var l=O(a,b);else c="prev";var d=a.options.tabSize,f=D(g,b),h=Wa(f.text,null,d),j=f.text.match(/^\s*/)[0],m;if("smart"==c&&(m=a.doc.mode.indent(l,f.text.slice(j.length),f.text),m==Wc)){if(!e)return;c="prev"}"prev"==c?m=b>g.first?Wa(D(g,b-1).text,null,d):0:"add"==c?m=h+a.options.indentUnit:
"subtract"==c&&(m=h-a.options.indentUnit);m=Math.max(0,m);c="";e=0;if(a.options.indentWithTabs)for(g=Math.floor(m/d);g;--g)e+=d,c+="\t";e<m&&(c+=kd(m-e));c!=j&&Aa(a.doc,c,z(b,0),z(b,j.length),"+input");f.stateAfter=null}function Qb(a,b,c){var e=b,g=b,l=a.doc;"number"==typeof b?g=D(l,Math.max(l.first,Math.min(b,l.first+l.size-1))):e=da(b);if(null!=e&&c(g,e))S(a,e,e+1);else return null;return g}function yc(a,b,c,e,g){function l(b){var e=(g?jc:ld)(h,f,c,!0);if(null==e){if(b=!b)b=d+c,b<a.first||b>=a.first+
a.size?b=j=!1:(d=b,b=h=D(a,b));if(b)f=g?(0>c?Cb:Bb)(h):0>c?h.text.length:0;else return j=!1}else f=e;return!0}var d=b.line,f=b.ch,h=D(a,d),j=!0;if("char"==e)l();else if("column"==e)l(!0);else if("word"==e||"group"==e){b=null;e="group"==e;for(var m=!0;!(0>c)||l(!m);m=!1){var n=h.text.charAt(f)||"\n",n=Rb(n)?"w":!e?null:/\s/.test(n)?null:"p";if(b&&b!=n){0>c&&(c=1,l());break}n&&(b=n);if(0<c&&!l(!m))break}}b=Ob(a,z(d,f),c,!0);j||(b.hitSide=!0);return b}function md(a,b,c,e){var g=a.doc,l=b.left,d;"page"==
e?(e=Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),d=b.top+c*(e-(0>c?1.5:0.5)*Y(a.display))):"line"==e&&(d=0<c?b.bottom+3:b.top-3);for(;;){var f=ea(a,l,d);if(!f.outside)break;if(0>c?0>=d:d>=g.height){f.hitSide=!0;break}d+=5*c}return f}function dc(a,b){var c=b.ch,e=b.ch;if(a){!1===b.after||e==a.length?--c:++e;for(var g=a.charAt(c),g=Rb(g)?Rb:/\s/.test(g)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!Rb(a)};0<c&&g(a.charAt(c-1));)--c;
for(;e<a.length&&g(a.charAt(e));)++e}return{from:z(b.line,c),to:z(b.line,e)}}function I(a,b,c,e){k.defaults[a]=b;c&&(Qa[a]=e?function(a,b,e){e!=Oc&&c(a,b,e)}:c)}function Va(a,b){if(!0===b)return b;if(a.copyState)return a.copyState(b);var c={},e;for(e in b){var g=b[e];g instanceof Array&&(g=g.concat([]));c[e]=g}return c}function Sc(a,b,c){return a.startState?a.startState(b,c):!0}function oc(a){return"string"==typeof a?ua[a]:a}function mb(a,b,c){function e(b){b=oc(b);var g=b[a];if(!1===g)return"stop";
if(null!=g&&c(g))return!0;if(b.nofallthrough)return"stop";b=b.fallthrough;if(null==b)return!1;if("[object Array]"!=Object.prototype.toString.call(b))return e(b);for(var g=0,l=b.length;g<l;++g){var d=e(b[g]);if(d)return d}return!1}for(var g=0;g<b.length;++g){var l=e(b[g]);if(l)return l}}function $c(a){a=La[a.keyCode];return"Ctrl"==a||"Alt"==a||"Shift"==a||"Mod"==a}function ad(a,b){if(ka&&34==a.keyCode&&a["char"])return!1;var c=La[a.keyCode];if(null==c||a.altGraphKey)return!1;a.altKey&&(c="Alt-"+c);
if(nd?a.metaKey:a.ctrlKey)c="Ctrl-"+c;if(nd?a.ctrlKey:a.metaKey)c="Cmd-"+c;!b&&a.shiftKey&&(c="Shift-"+c);return c}function ob(a,b){this.pos=this.start=0;this.string=a;this.tabSize=b||8;this.lastColumnPos=this.lastColumnValue=0}function Ma(a,b){this.lines=[];this.type=b;this.doc=a}function pb(a,b,c,e,g){if(e&&e.shared){var l=e,l=Sb(l);l.shared=!1;var d=[pb(a,b,c,l,g)],f=d[0],h=l.replacedWith;$a(a,function(a){h&&(l.replacedWith=h.cloneNode(!0));d.push(pb(a,F(a,b),F(a,c),l,g));for(var e=0;e<a.linked.length;++e)if(a.linked[e].isParent)return;
f=$(d)});return new qb(d,f)}if(a.cm&&!a.cm.curOp)return A(a.cm,pb)(a,b,c,e,g);var j=new Ma(a,g);if("range"==g&&!P(b,c))return j;e&&Sb(e,j);j.replacedWith&&(j.collapsed=!0,j.replacedWith=C("span",[j.replacedWith],"CodeMirror-widget"));j.collapsed&&(ib=!0);j.addToHistory&&dd(a,{from:b,to:c,origin:"markText"},{head:a.sel.head,anchor:a.sel.anchor},NaN);var m=b.line,n=0,k,p,s=a.cm,y;a.iter(m,c.line+1,function(e){s&&(j.collapsed&&!s.options.lineWrapping&&Sa(a,e)==s.display.maxLine)&&(y=!0);var g={from:null,
to:null,marker:j};n+=e.text.length;m==b.line&&(g.from=b.ch,n-=b.ch);m==c.line&&(g.to=c.ch,n-=e.text.length-c.ch);j.collapsed&&(m==c.line&&(p=Fa(e,c.ch)),m==b.line?k=Fa(e,b.ch):la(e,0));e.markedSpans=e.markedSpans?e.markedSpans.concat([g]):[g];g.marker.attachLine(e);++m});j.collapsed&&a.iter(b.line,c.line+1,function(b){Ea(a,b)&&la(b,0)});j.clearOnEnter&&H(j,"beforeCursorEnter",function(){j.clear()});j.readOnly&&(cd=!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory());if(j.collapsed){if(k!=
p)throw Error("Inserting collapsed marker overlapping an existing one");j.size=n;j.atomic=!0}s&&(y&&(s.curOp.updateMaxLine=!0),(j.className||j.startStyle||j.endStyle||j.collapsed)&&S(s,b.line,c.line+1),j.atomic&&id(s));return j}function qb(a,b){this.markers=a;this.primary=b;for(var c=0,e=this;c<a.length;++c)a[c].parent=this,H(a[c],"clear",function(){e.clear()})}function rb(a,b){if(a)for(var c=0;c<a.length;++c){var e=a[c];if(e.marker==b)return e}}function uc(a,b){var c=ab(a,b.from.line)&&D(a,b.from.line).markedSpans,
e=ab(a,b.to.line)&&D(a,b.to.line).markedSpans;if(!c&&!e)return null;var g=b.from.ch,l=b.to.ch,d=N(b.from,b.to);if(c)for(var f=0,h;f<c.length;++f){var j=c[f],m=j.marker;if(null==j.from||(m.inclusiveLeft?j.from<=g:j.from<g)||"bookmark"==m.type&&j.from==g&&(!d||!j.marker.insertLeft)){var n=null==j.to||(m.inclusiveRight?j.to>=g:j.to>g);(h||(h=[])).push({from:j.from,to:n?null:j.to,marker:m})}}c=h;if(e)for(var f=0,k;f<e.length;++f)if(h=e[f],j=h.marker,null==h.to||(j.inclusiveRight?h.to>=l:h.to>l)||"bookmark"==
j.type&&h.from==l&&(!d||h.marker.insertLeft))m=null==h.from||(j.inclusiveLeft?h.from<=l:h.from<l),(k||(k=[])).push({from:m?null:h.from-l,to:null==h.to?null:h.to-l,marker:j});e=k;d=1==b.text.length;k=$(b.text).length+(d?g:0);if(c)for(l=0;l<c.length;++l)f=c[l],null==f.to&&((h=rb(e,f.marker))?d&&(f.to=null==h.to?null:h.to+k):f.to=g);if(e)for(l=0;l<e.length;++l)f=e[l],null!=f.to&&(f.to+=k),null==f.from?(h=rb(c,f.marker),h||(f.from=k,d&&(c||(c=[])).push(f))):(f.from+=k,d&&(c||(c=[])).push(f));g=[c];if(!d){var d=
b.text.length-2,p;if(0<d&&c)for(l=0;l<c.length;++l)null==c[l].to&&(p||(p=[])).push({from:null,to:null,marker:c[l].marker});for(l=0;l<d;++l)g.push(p);g.push(e)}return g}function gd(a,b){var c;if(c=b["spans_"+a.id]){for(var e=0,g=[];e<b.text.length;++e)g.push(Td(c[e]));c=g}else c=null;e=uc(a,b);if(!c)return e;if(!e)return c;for(g=0;g<c.length;++g){var l=c[g],d=e[g];if(l&&d){var f=0;a:for(;f<d.length;++f){for(var h=d[f],j=0;j<l.length;++j)if(l[j].marker==h.marker)continue a;l.push(h)}}else d&&(c[g]=
d)}return c}function Fa(a,b){var c=ib&&a.markedSpans,e;if(c)for(var g,l=0;l<c.length;++l)if(g=c[l],g.marker.collapsed&&(null==g.from||g.from<b)&&(null==g.to||g.to>b)&&(!e||e.width<g.marker.width))e=g.marker;return e}function hb(a){return Fa(a,a.text.length+1)}function Sa(a,b){for(var c;c=Fa(b,-1);)b=D(a,c.find().from.line);return b}function Ea(a,b){var c=ib&&b.markedSpans;if(c)for(var e,g=0;g<c.length;++g)if(e=c[g],e.marker.collapsed&&(null==e.from||0==e.from&&e.marker.inclusiveLeft&&zc(a,b,e)))return!0}
function zc(a,b,c){if(null==c.to)return b=c.marker.find().to,b=D(a,b.line),zc(a,b,rb(b.markedSpans,c.marker));if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var e,g=0;g<b.markedSpans.length;++g)if(e=b.markedSpans[g],e.marker.collapsed&&e.from==c.to&&(e.marker.inclusiveLeft||c.marker.inclusiveRight)&&zc(a,b,e))return!0}function od(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function pd(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);
a.markedSpans=b}}function qd(a){return function(){var b=!this.cm.curOp;b&&qa(this.cm);try{var c=a.apply(this,arguments)}finally{b&&ya(this.cm)}return c}}function Ab(a){if(null!=a.height)return a.height;(!a.node.parentNode||1!=a.node.parentNode.nodeType)&&oa(a.cm.display.measure,C("div",[a.node],null,"position: relative"));return a.height=a.node.offsetHeight}function sb(a,b,c){a={text:a};pd(a,b);a.height=c?c(a):1;return a}function rd(a,b,c,e,g){var l=c.flattenSpans;null==l&&(l=a.options.flattenSpans);
var d="",f=null,h=new ob(b,a.options.tabSize),j;for(""==b&&c.blankLine&&c.blankLine(e);!h.eol();){h.pos>a.options.maxHighlightLength?(l=!1,h.pos=Math.min(b.length,h.start+5E4),j=null):j=c.token(h,e);var m=h.current();h.start=h.pos;!l||f!=j?(d&&g(d,f),d=m,f=j):d+=m}d&&g(d,f)}function Qc(a,b,c){var e=[a.state.modeGen];rd(a,b.text,a.doc.mode,c,function(a,b){e.push(a,b)});for(c=0;c<a.state.overlays.length;++c){var g=a.state.overlays[c],l=1;rd(a,b.text,g.mode,!0,function(a,b){for(var c=l,d=a.length;d;){var f=
e[l],h=f.length;h<=d?d-=h:(e.splice(l,1,f.slice(0,d),e[l+1],f.slice(d)),d=0);l+=2}if(b)if(g.opaque)e.splice(c,l-c,a,b),l=c+2;else for(;c<l;c+=2)f=e[c+1],e[c+1]=f?f+" "+b:b})}return e}function Rc(a,b,c){var e=a.doc.mode,g=new ob(b.text,a.options.tabSize);for(""==b.text&&e.blankLine&&e.blankLine(c);!g.eol()&&g.pos<=a.options.maxHighlightLength;)e.token(g,c),g.start=g.pos}function sd(a){return!a?null:td[a]||(td[a]="cm-"+a.replace(/ +/g," cm-"))}function ic(a,b,c){for(var e,g=b,l,d,f=!0;e=Fa(g,-1);)f=
!1,g=D(a.doc,e.find().from.line),l||(l=g);e={pre:C("pre"),col:0,pos:0,display:!c,measure:null,addedOne:!1,cm:a};g.textClass&&(e.pre.className=g.textClass);do{e.measure=g==b&&c;e.pos=0;e.addToken=e.measure?Ud:ud;if((R||fa)&&a.getOption("lineWrapping"))e.addToken=Vd(e.addToken);c&&(d&&g!=b&&!e.addedOne)&&(c[0]=e.pre.appendChild(Eb(a.display.measure)),e.addedOne=!0);var h=g;d=e;var j=g;if(!j.styles||j.styles[0]!=a.state.modeGen)j.styles=Qc(a,j,j.stateAfter=O(a,da(j)));a:{var m=h,j=j.styles;if(h=m.markedSpans)for(var m=
m.text.length,n=0,k=1,p="",s=void 0,y=0,E=void 0,w=void 0,K=void 0,r=void 0;;){if(y==n){for(var E=w=K="",r=null,y=Infinity,J=null,A=0;A<h.length;++A){var u=h[A],t=u.marker;if(u.from<=n&&(null==u.to||u.to>n)){if(null!=u.to&&y>u.to&&(y=u.to,w=""),t.className&&(E+=" "+t.className),t.startStyle&&u.from==n&&(K+=" "+t.startStyle),t.endStyle&&u.to==y&&(w+=" "+t.endStyle),t.collapsed&&(!r||r.marker.width<t.width))r=u}else u.from>n&&y>u.from&&(y=u.from);"bookmark"==t.type&&(u.from==n&&t.replacedWith)&&(J=
t.replacedWith)}if(r&&(r.from||0)==n)if(vd(d,(null==r.to?m:r.to)-n,null!=r.from&&r.marker.replacedWith),null==r.to){j=r.marker.find();break a}J&&!r&&vd(d,0,J)}if(n>=m)break;for(J=Math.min(m,y);;){if(p){A=n+p.length;r||(u=A>J?p.slice(0,J-n):p,d.addToken(d,u,s?s+E:E,K,n+u.length==y?w:""));if(A>=J){p=p.slice(J-n);n=J;break}n=A;K=""}p=j[k++];s=sd(j[k++])}}else for(var k=1;k<j.length;k+=2)d.addToken(d,j[k],sd(j[k+1]));j=void 0}d=g==l;j&&(g=D(a.doc,j.to.line),f=!1)}while(j);c&&!e.addedOne&&(c[0]=e.pre.appendChild(f?
C("span","\u00a0"):Eb(a.display.measure)));!e.pre.firstChild&&!Ea(a.doc,b)&&e.pre.appendChild(document.createTextNode("\u00a0"));var M;if(c&&R&&(M=na(g)))if(l=M.length-1,M[l].from==M[l].to&&--l,g=M[l],M=M[l-1],g.from+1==g.to&&(M&&g.level<M.level)&&(c=c[e.pos-1]))c.parentNode.insertBefore(c.measureRight=Eb(a.display.measure),c.nextSibling);X(a,"renderLine",a,b,e.pre);return e.pre}function ud(a,b,c,e,g){if(b){if(Ac.test(b))for(var l=document.createDocumentFragment(),d=0;;){Ac.lastIndex=d;var f=Ac.exec(b),
h=f?f.index-d:b.length-d;h&&(l.appendChild(document.createTextNode(b.slice(d,d+h))),a.col+=h);if(!f)break;d+=h+1;"\t"==f[0]?(f=a.cm.options.tabSize,f-=a.col%f,l.appendChild(C("span",kd(f),"cm-tab")),a.col+=f):(h=C("span","\u2022","cm-invalidchar"),h.title="\\u"+f[0].charCodeAt(0).toString(16),l.appendChild(h),a.col+=1)}else{a.col+=b.length;var l=document.createTextNode(b)}if(c||e||g||a.measure)return b=c||"",e&&(b+=e),g&&(b+=g),a.pre.appendChild(C("span",[l],b));a.pre.appendChild(l)}}function Ud(a,
b,c,e,g){for(var d=a.cm.options.lineWrapping,f=0;f<b.length;++f){var h=b.charAt(f),j=0==f;"\ud800"<=h&&"\udbff">h&&f<b.length-1?(h=b.slice(f,f+2),++f):f&&(d&&Tb.test(b.slice(f-1,f+1)))&&a.pre.appendChild(C("wbr"));j=a.measure[a.pos]=ud(a,h,c,j&&e,f==b.length-1&&g);R&&(d&&" "==h&&f&&!/\s/.test(b.charAt(f-1))&&f<b.length-1&&!/\s/.test(b.charAt(f+1)))&&(j.style.whiteSpace="normal");a.pos+=h.length}b.length&&(a.addedOne=!0)}function Vd(a){function b(a){for(var b=" ",g=0;g<a.length-2;++g)b+=g%2?" ":"\u00a0";
return b+" "}return function(c,e,g,d,f){return a(c,e.replace(/ {3,}/,b),g,d,f)}}function vd(a,b,c){c&&(a.display||(c=c.cloneNode(!0)),a.pre.appendChild(c),a.measure&&b&&(a.measure[a.pos]=c,a.addedOne=!0));a.pos+=b}function xc(a,b,c,e,g){function d(a,c,e){var l=g;a.text=c;a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null);null!=a.order&&(a.order=null);od(a);pd(a,e);c=l?l(a):1;c!=a.height&&la(a,c);ma(a,"change",a,b)}var f=b.from,h=b.to,j=b.text,m=D(a,f.line),n=D(a,h.line),k=$(j),p=c?c[j.length-
1]:null,s=h.line-f.line;if(0==f.ch&&0==h.ch&&""==k){for(var y=0,E=j.length-1,w=[];y<E;++y)w.push(sb(j[y],c?c[y]:null,g));d(n,n.text,p);s&&a.remove(f.line,s);w.length&&a.insert(f.line,w)}else if(m==n)if(1==j.length)d(m,m.text.slice(0,f.ch)+k+m.text.slice(h.ch),p);else{w=[];y=1;for(E=j.length-1;y<E;++y)w.push(sb(j[y],c?c[y]:null,g));w.push(sb(k+m.text.slice(h.ch),p,g));d(m,m.text.slice(0,f.ch)+j[0],c?c[0]:null);a.insert(f.line+1,w)}else if(1==j.length)d(m,m.text.slice(0,f.ch)+j[0]+n.text.slice(h.ch),
c?c[0]:null),a.remove(f.line+1,s);else{d(m,m.text.slice(0,f.ch)+j[0],c?c[0]:null);d(n,k+n.text.slice(h.ch),p);y=1;E=j.length-1;for(w=[];y<E;++y)w.push(sb(j[y],c?c[y]:null,g));1<s&&a.remove(f.line+1,s-1);a.insert(f.line+1,w)}ma(a,"change",a,b);za(a,e.anchor,e.head,null,!0)}function Ub(a){this.lines=a;this.parent=null;for(var b=0,c=a.length,e=0;b<c;++b)a[b].parent=this,e+=a[b].height;this.height=e}function tb(a){this.children=a;for(var b=0,c=0,e=0,g=a.length;e<g;++e){var d=a[e],b=b+d.chunkSize(),c=
c+d.height;d.parent=this}this.size=b;this.height=c;this.parent=null}function $a(a,b,c){function e(a,d,f){if(a.linked)for(var h=0;h<a.linked.length;++h){var j=a.linked[h];if(j.doc!=d){var m=f&&j.sharedHist;if(!c||m)b(j.doc,m),e(j.doc,a,m)}}}e(a,null,!0)}function Hc(a,b){if(b.cm)throw Error("This document is already in use.");a.doc=b;b.cm=a;u(a);x(a);a.options.lineWrapping||m(a);a.options.mode=b.modeOption;S(a)}function D(a,b){for(b-=a.first;!a.lines;)for(var c=0;;++c){var e=a.children[c],g=e.chunkSize();
if(b<g){a=e;break}b-=g}return a.lines[b]}function wc(a,b,c){var e=[],g=b.line;a.iter(b.line,c.line+1,function(a){a=a.text;g==c.line&&(a=a.slice(0,c.ch));g==b.line&&(a=a.slice(b.ch));e.push(a);++g});return e}function Bc(a,b,c){var e=[];a.iter(b,c,function(a){e.push(a.text)});return e}function la(a,b){for(var c=b-a.height,e=a;e;e=e.parent)e.height+=c}function da(a){if(null==a.parent)return null;var b=a.parent;a=ta(b.lines,a);for(var c=b.parent;c;b=c,c=c.parent)for(var e=0;c.children[e]!=b;++e)a+=c.children[e].chunkSize();
return a+b.first}function zb(a,b){var c=a.first;a:do{for(var e=0,g=a.children.length;e<g;++e){var d=a.children[e],f=d.height;if(b<f){a=d;continue a}b-=f;c+=d.chunkSize()}return c}while(!a.lines);e=0;for(g=a.lines.length;e<g;++e){d=a.lines[e].height;if(b<d)break;b-=d}return c+e}function Ua(a,b){b=Sa(a.doc,b);for(var c=0,e=b.parent,g=0;g<e.lines.length;++g){var d=e.lines[g];if(d==b)break;else c+=d.height}for(d=e.parent;d;e=d,d=e.parent)for(g=0;g<d.children.length;++g){var f=d.children[g];if(f==e)break;
else c+=f.height}return c}function na(a){var b=a.order;null==b&&(b=a.order=wd(a.text));return b}function Vb(){return{done:[],undone:[],undoDepth:Infinity,lastTime:0,lastOp:null,lastOrigin:null,dirtyCounter:0}}function xd(a,b,c,e){var g=b["spans_"+a.id],d=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,e),function(c){c.markedSpans&&((g||(g=b["spans_"+a.id]={}))[d]=c.markedSpans);++d})}function vc(a,b){var c={from:b.from,to:rc(b),text:wc(a,b.from,b.to)};xd(a,c,b.from.line,b.to.line+1);$a(a,function(a){xd(a,
c,b.from.line,b.to.line+1)},!0);return c}function dd(a,b,c,e){var g=a.history;g.undone.length=0;var d=+new Date,f=$(g.done);if(f&&(g.lastOp==e||g.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&g.lastTime>d-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0)))){var h=$(f.changes);N(b.from,b.to)&&N(b.from,h.to)?h.to=rc(b):f.changes.push(vc(a,b));f.anchorAfter=c.anchor;f.headAfter=c.head}else{f={changes:[vc(a,b)],anchorBefore:a.sel.anchor,headBefore:a.sel.head,anchorAfter:c.anchor,
headAfter:c.head};for(g.done.push(f);g.done.length>g.undoDepth;)g.done.shift();0>g.dirtyCounter?g.dirtyCounter=NaN:g.dirtyCounter++}g.lastTime=d;g.lastOp=e;g.lastOrigin=b.origin}function Td(a){if(!a)return null;for(var b=0,c;b<a.length;++b)a[b].marker.explicitlyCleared?c||(c=a.slice(0,b)):c&&c.push(a[b]);return!c?a:c.length?c:null}function Wb(a,b){for(var c=0,e=[];c<a.length;++c){var g=a[c],d=g.changes,f=[];e.push({changes:f,anchorBefore:g.anchorBefore,headBefore:g.headBefore,anchorAfter:g.anchorAfter,
headAfter:g.headAfter});for(g=0;g<d.length;++g){var h=d[g],j;f.push({from:h.from,to:h.to,text:h.text});if(b)for(var m in h)if((j=m.match(/^spans_(\d+)$/))&&-1<ta(b,Number(j[1])))$(f)[m]=h[m],delete h[m]}}return e}function Xb(a,b,c,e){c<a.line?a.line+=e:b<a.line&&(a.line=b,a.ch=0)}function yd(a,b,c,e){for(var g=0;g<a.length;++g){for(var d=a[g],f=!0,h=0;h<d.changes.length;++h){var j=d.changes[h];d.copied||(j.from=Ka(j.from),j.to=Ka(j.to));if(c<j.from.line)j.from.line+=e,j.to.line+=e;else if(b<=j.to.line){f=
!1;break}}d.copied||(d.anchorBefore=Ka(d.anchorBefore),d.headBefore=Ka(d.headBefore),d.anchorAfter=Ka(d.anchorAfter),d.readAfter=Ka(d.headAfter),d.copied=!0);f?(Xb(d.anchorBefore),Xb(d.headBefore),Xb(d.anchorAfter),Xb(d.headAfter)):(a.splice(0,g+1),g=0)}}function ed(a,b){var c=b.from.line,e=b.to.line,g=b.text.length-(e-c)-1;yd(a.done,c,e,g);yd(a.undone,c,e,g)}function Wd(){eb(this)}function db(a){a.stop||(a.stop=Wd);return a}function T(a){a.preventDefault?a.preventDefault():a.returnValue=!1}function zd(a){a.stopPropagation?
a.stopPropagation():a.cancelBubble=!0}function eb(a){T(a);zd(a)}function Vc(a){var b=a.which;null==b&&(a.button&1?b=1:a.button&2?b=3:a.button&4&&(b=2));Ta&&(a.ctrlKey&&1==b)&&(b=3);return b}function H(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):(a=a._handlers||(a._handlers={}),(a[b]||(a[b]=[])).push(c))}function ra(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else if(a=a._handlers&&a._handlers[b])for(b=
0;b<a.length;++b)if(a[b]==c){a.splice(b,1);break}}function X(a,b){var c=a._handlers&&a._handlers[b];if(c)for(var e=Array.prototype.slice.call(arguments,2),g=0;g<c.length;++g)c[g].apply(null,e)}function ma(a,b){function c(a){return function(){a.apply(null,g)}}var e=a._handlers&&a._handlers[b];if(e){var g=Array.prototype.slice.call(arguments,2);xa||(++Db,xa=[],setTimeout(Xd,0));for(var d=0;d<e.length;++d)xa.push(c(e[d]))}}function Xd(){--Db;var a=xa;xa=null;for(var b=0;b<a.length;++b)a[b]()}function Ya(a,
b){var c=a._handlers&&a._handlers[b];return c&&0<c.length}function bc(){this.id=null}function Wa(a,b,c,e,g){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));e=e||0;for(g=g||0;e<b;++e)"\t"==a.charAt(e)?g+=c-g%c:++g;return g}function kd(a){for(;Yb.length<=a;)Yb.push($(Yb)+" ");return Yb[a]}function $(a){return a[a.length-1]}function Jc(a){bb?(a.selectionStart=0,a.selectionEnd=a.value.length):a.select()}function ta(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0,e=a.length;c<e;++c)if(a[c]==
b)return c;return-1}function Sb(a,b){b||(b={});for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function Tc(a){for(var b=[],c=0;c<a;++c)b.push(void 0);return b}function ga(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function Rb(a){return/\w/.test(a)||"\u0080"<a&&(a.toUpperCase()!=a.toLowerCase()||Yd.test(a))}function Ad(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function C(a,b,c,e){a=document.createElement(a);c&&(a.className=
c);e&&(a.style.cssText=e);if("string"==typeof b)Pc(a,b);else if(b)for(c=0;c<b.length;++c)a.appendChild(b[c]);return a}function xb(a){for(var b=a.childNodes.length;0<b;--b)a.removeChild(a.firstChild);return a}function oa(a,b){return xb(a).appendChild(b)}function Pc(a,b){ha?(a.innerHTML="",a.appendChild(document.createTextNode(b))):a.textContent=b}function Q(a){return a.getBoundingClientRect()}function yb(a){if(null!=Zb)return Zb;var b=C("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");
oa(a,b);b.offsetWidth&&(Zb=b.offsetHeight-b.clientHeight);return Zb||0}function Eb(a){if(null==Cc){var b=C("span","\u200b");oa(a,C("span",[b,document.createTextNode("x")]));0!=a.firstChild.offsetHeight&&(Cc=1>=b.offsetWidth&&2<b.offsetHeight&&!Na)}return Cc?C("span","\u200b"):C("span","\u00a0",null,"display: inline-block; width: 1px; margin-right: -1px")}function Dc(a){return a.level%2?a.from:a.to}function Bb(a){return(a=na(a))?a[0].level%2?a[0].to:a[0].from:0}function Cb(a){var b=na(a);return!b?
a.text.length:Dc($(b))}function Bd(a,b){var c=D(a.doc,b),e=Sa(a.doc,c);e!=c&&(b=da(e));c=na(e);e=!c?0:c[0].level%2?Cb(e):Bb(e);return z(b,e)}function Zd(a,b){for(var c,e;c=hb(e=D(a.doc,b));)b=c.find().to.line;c=na(e);e=!c?e.text.length:c[0].level%2?Bb(e):Cb(e);return z(b,e)}function jc(a,b,c,e){var g=na(a);if(!g)return ld(a,b,c,e);e=e?function(b,c){do b+=c;while(0<b&&kc.test(a.text.charAt(b)));return b}:function(a,b){return a+b};for(var d=g[0].level,f=0;f<g.length;++f){var h=g[f],j=h.level%2==d;if(h.from<
b&&h.to>b||j&&(h.from==b||h.to==b))break}for(b=e(b,h.level%2?-c:c);null!=b;)if(h.level%2==d)if(b<h.from||b>h.to)b=(h=g[f+=c])&&(0<c==h.level%2?e(h.to,-1):e(h.from,1));else break;else if(b==(h.level%2?h.to:h.from))b=(h=g[--f])&&Dc(h);else if(b==Dc(h))b=(h=g[++f])&&(h.level%2?h.to:h.from);else break;return 0>b||b>a.text.length?null:b}function ld(a,b,c,e){b+=c;if(e)for(;0<b&&kc.test(a.text.charAt(b));)b+=c;return 0>b||b>a.text.length?null:b}var Za=/gecko\/\d/i.test(navigator.userAgent),R=/MSIE \d/.test(navigator.userAgent),
Na=R&&(null==document.documentMode||8>document.documentMode),ha=R&&(null==document.documentMode||9>document.documentMode),fa=/WebKit\//.test(navigator.userAgent),$d=fa&&/Qt\/\d+\.\d+/.test(navigator.userAgent),ae=/Chrome\//.test(navigator.userAgent),ka=/Opera\//.test(navigator.userAgent),gc=/Apple Computer/.test(navigator.vendor),ac=/KHTML\//.test(navigator.userAgent),Od=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),Pd=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Rd=/PhantomJS/.test(navigator.userAgent),
bb=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),cc=bb||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),Ta=bb||/Mac/.test(navigator.platform),be=/windows/i.test(navigator.platform),ub=ka&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);ub&&(ub=Number(ub[1]));var nd=Ta&&($d||ka&&(null==ub||12.11>ub)),ec=Za||R&&!ha,cd=!1,ib=!1,Ia,Qd=0,Jb,Ib,Kb=0,ia=null;R?ia=-0.53:Za?ia=15:ae?ia=-0.7:gc&&(ia=-1/3);var Zc,pc=null,qc;k.Pos=z;k.prototype=
{focus:function(){window.focus();ba(this);Da(this);gb(this)},setOption:function(a,b){var c=this.options,e=c[a];c[a]==b&&"mode"!=a||(c[a]=b,Qa.hasOwnProperty(a)&&A(this,Qa[a])(this,b,e))},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](a)},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(("string"==typeof a?b[c].name:b[c])==a)return b.splice(c,1),!0},addOverlay:A(null,function(a,
b){var c=a.token?a:k.getMode(this.options,a);if(c.startState)throw Error("Overlays may not be stateful.");this.state.overlays.push({mode:c,modeSpec:a,opaque:b&&b.opaque});this.state.modeGen++;S(this)}),removeOverlay:A(null,function(a){for(var b=this.state.overlays,c=0;c<b.length;++c)if(b[c].modeSpec==a){b.splice(c,1);this.state.modeGen++;S(this);break}}),indentLine:A(null,function(a,b,c){"string"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract");ab(this.doc,a)&&Mb(this,
a,b,c)}),indentSelection:A(null,function(a){var b=this.doc.sel;if(N(b.from,b.to))return Mb(this,b.from.line,a);for(var c=b.to.line-(b.to.ch?0:1),b=b.from.line;b<=c;++b)Mb(this,b,a)}),getTokenAt:function(a){var b=this.doc;a=F(b,a);for(var c=O(this,a.line),e=this.doc.mode,b=D(b,a.line),b=new ob(b.text,this.options.tabSize);b.pos<a.ch&&!b.eol();){b.start=b.pos;var g=e.token(b,c)}return{start:b.start,end:b.pos,string:b.current(),className:g||null,type:g||null,state:c}},getStateAfter:function(a){var b=
this.doc;a=Math.max(b.first,Math.min(null==a?b.first+b.size-1:a,b.first+b.size-1));return O(this,a+1)},cursorCoords:function(a,b){var c;c=this.doc.sel;c=null==a?c.head:"object"==typeof a?F(this.doc,a):a?c.from:c.to;return V(this,c,b||"page")},charCoords:function(a,b){return Z(this,F(this.doc,a),b||"page")},coordsChar:function(a,b){var c=b||"page";if("div"!=c){var e=a.left,g=a.top;"page"==c&&(e-=window.pageXOffset||(document.documentElement||document.body).scrollLeft,g-=window.pageYOffset||(document.documentElement||
document.body).scrollTop);var d=Q(this.display.lineSpace),e=e-d.left,g=g-d.top;if("local"==c||!c)c=Q(this.display.wrapper),e+=c.left,g+=c.top;a={left:e,top:g}}return ea(this,a.left,a.top)},defaultTextHeight:function(){return Y(this.display)},defaultCharWidth:function(){return Ra(this.display)},setGutterMarker:A(null,function(a,b,c){return Qb(this,a,function(a){var g=a.gutterMarkers||(a.gutterMarkers={});g[b]=c;!c&&Ad(g)&&(a.gutterMarkers=null);return!0})}),clearGutter:A(null,function(a){var b=this,
c=b.doc,e=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&(c.gutterMarkers[a]=null,S(b,e,e+1),Ad(c.gutterMarkers)&&(c.gutterMarkers=null));++e})}),addLineClass:A(null,function(a,b,c){return Qb(this,a,function(a){var g="text"==b?"textClass":"background"==b?"bgClass":"wrapClass";if(a[g]){if(RegExp("\\b"+c+"\\b").test(a[g]))return!1;a[g]+=" "+c}else a[g]=c;return!0})}),removeLineClass:A(null,function(a,b,c){return Qb(this,a,function(a){var g="text"==b?"textClass":"background"==b?"bgClass":
"wrapClass",d=a[g];if(d)if(null==c)a[g]=null;else{var f=d.replace(RegExp("^"+c+"\\b\\s*|\\s*\\b"+c+"\\b"),"");if(f==d)return!1;a[g]=f||null}else return!1;return!0})}),addLineWidget:A(null,function(a,b,c){var e=this,g=new Ec(e,b,c);g.noHScroll&&(e.display.alignWidgets=!0);Qb(e,a,function(a){(a.widgets||(a.widgets=[])).push(g);g.line=a;if(!Ea(e.doc,a)||g.showIfHidden){var b=Ua(e,a)<e.display.scroller.scrollTop;la(a,a.height+Ab(g));b&&jd(e,0,g.height)}return!0});return g}),removeLineWidget:function(a){a.clear()},
lineInfo:function(a){if("number"==typeof a){if(!ab(this.doc,a))return null;var b=a;a=D(this.doc,a);if(!a)return null}else if(b=da(a),null==b)return null;return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},getViewport:function(){return{from:this.display.showingFrom,to:this.display.showingTo}},addWidget:function(a,b,c,e,g){var d=this.display;a=V(this,F(this.doc,a));var f=a.bottom,h=a.left;b.style.position=
"absolute";d.sizer.appendChild(b);if("over"==e)f=a.top;else if("above"==e||"near"==e){var j=Math.max(d.wrapper.clientHeight,this.doc.height),m=Math.max(d.sizer.clientWidth,d.lineSpace.clientWidth);("above"==e||a.bottom+b.offsetHeight>j)&&a.top>b.offsetHeight?f=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=j&&(f=a.bottom);h+b.offsetWidth>m&&(h=m-b.offsetWidth)}b.style.top=f+d.lineSpace.offsetTop+"px";b.style.left=b.style.right="";"right"==g?(h=d.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):
("left"==g?h=0:"middle"==g&&(h=(d.sizer.clientWidth-b.offsetWidth)/2),b.style.left=h+"px");c&&(a=Fb(this,h,f,h+b.offsetWidth,f+b.offsetHeight),null!=a.scrollTop&&fb(this,a.scrollTop),null!=a.scrollLeft&&Pa(this,a.scrollLeft))},triggerOnKeyDown:A(null,Nc),execCommand:function(a){return nc[a](this)},findPosH:function(a,b,c,e){var g=1;0>b&&(g=-1,b=-b);var d=0;for(a=F(this.doc,a);d<b&&!(a=yc(this.doc,a,g,c,e),a.hitSide);++d);return a},moveH:A(null,function(a,b){var c=this.doc.sel,c=c.shift||c.extend||
N(c.from,c.to)?yc(this.doc,c.head,a,b,this.options.rtlMoveVisually):0>a?c.from:c.to;U(this.doc,c,c,a)}),deleteH:A(null,function(a,b){var c=this.doc.sel;N(c.from,c.to)?Aa(this.doc,"",c.from,yc(this.doc,c.head,a,b,!1),"+delete"):Aa(this.doc,"",c.from,c.to,"+delete");this.curOp.userSelChange=!0}),findPosV:function(a,b,c,e){var g=1;0>b&&(g=-1,b=-b);var d=0;for(a=F(this.doc,a);d<b&&!(a=V(this,a,"div"),null==e?e=a.left:a.left=e,a=md(this,a,g,c),a.hitSide);++d);return a},moveV:A(null,function(a,b){var c=
this.doc.sel,e=V(this,c.head,"div");null!=c.goalColumn&&(e.left=c.goalColumn);var g=md(this,e,a,b);"page"==b&&jd(this,0,Z(this,g,"div").top-e.top);U(this.doc,g,g,a);c.goalColumn=e.left}),toggleOverwrite:function(){this.display.cursor.className=(this.state.overwrite=!this.state.overwrite)?this.display.cursor.className+" CodeMirror-overwrite":this.display.cursor.className.replace(" CodeMirror-overwrite","")},hasFocus:function(){return this.state.focused},scrollTo:A(null,function(a,b){Pb(this,a,b)}),
getScrollInfo:function(){var a=this.display.scroller,b=cb;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-b,width:a.scrollWidth-b,clientHeight:a.clientHeight-b,clientWidth:a.clientWidth-b}},scrollIntoView:A(null,function(a,b){"number"==typeof a&&(a=z(a,0));b||(b=0);var c=a;if(!a||null!=a.line)this.curOp.scrollToPos=a?F(this.doc,a):this.doc.sel.head,this.curOp.scrollToPosMargin=b,c=V(this,this.curOp.scrollToPos);c=Fb(this,c.left,c.top-b,c.right,c.bottom+b);Pb(this,c.scrollLeft,c.scrollTop)}),
setSize:function(a,b){function c(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a}null!=a&&(this.display.wrapper.style.width=c(a));null!=b&&(this.display.wrapper.style.height=c(b));this.refresh()},on:function(a,b){H(this,a,b)},off:function(a,b){ra(this,a,b)},operation:function(a){return Ic(this,a)},refresh:A(null,function(){ja(this);Pb(this,this.doc.scrollLeft,this.doc.scrollTop);S(this)}),swapDoc:A(null,function(a){var b=this.doc;b.cm=null;Hc(this,a);ja(this);va(this,!0);Pb(this,a.scrollLeft,
a.scrollTop);return b}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};var Qa=k.optionHandlers={},$b=k.defaults={},Oc=k.Init={toString:function(){return"CodeMirror.Init"}};I("value","",function(a,b){a.setValue(b)},!0);I("mode",null,function(a,b){a.doc.modeOption=b;x(a)},!0);I("indentUnit",2,x,!0);I("indentWithTabs",!1);
I("smartIndent",!0);I("tabSize",4,function(a){x(a);ja(a);S(a)},!0);I("electricChars",!0);I("rtlMoveVisually",!be);I("theme","default",function(a){r(a);p(a)},!0);I("keyMap","default",function(a){var b=ua[a.options.keyMap].style;a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(b?" cm-keymap-"+b:"")});I("extraKeys",null);I("onKeyEvent",null);I("onDragEvent",null);I("lineWrapping",!1,function(a){a.options.lineWrapping?(a.display.wrapper.className+=" CodeMirror-wrap",
a.display.sizer.style.minWidth=""):(a.display.wrapper.className=a.display.wrapper.className.replace(" CodeMirror-wrap",""),m(a));u(a);S(a);ja(a);setTimeout(function(){h(a.display,a.doc.height)},100)},!0);I("gutters",[],function(a){f(a.options);p(a)},!0);I("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?n(a.display)+"px":"0";a.refresh()},!0);I("lineNumbers",!1,function(a){f(a.options);p(a)},!0);I("firstLineNumber",1,p,!0);I("lineNumberFormatter",function(a){return a},p,!0);I("showCursorWhenSelecting",
!1,aa,!0);I("readOnly",!1,function(a,b){"nocursor"==b?(fc(a),a.display.input.blur()):b||va(a,!0)});I("dragDrop",!0);I("cursorBlinkRate",530);I("cursorHeight",1);I("workTime",100);I("workDelay",100);I("flattenSpans",!0);I("pollInterval",100);I("undoDepth",40,function(a,b){a.doc.history.undoDepth=b});I("historyEventDelay",500);I("viewportMargin",10,function(a){a.refresh()},!0);I("maxHighlightLength",1E4,function(a){x(a);a.refresh()},!0);I("moveInputWithCursor",!0,function(a,b){b||(a.display.inputDiv.style.top=
a.display.inputDiv.style.left=0)});I("tabindex",null,function(a,b){a.display.input.tabIndex=b||""});I("autofocus",null);var Cd=k.modes={},Fc=k.mimeModes={};k.defineMode=function(a,b){!k.defaults.mode&&"null"!=a&&(k.defaults.mode=a);if(2<arguments.length){b.dependencies=[];for(var c=2;c<arguments.length;++c)b.dependencies.push(arguments[c])}Cd[a]=b};k.defineMIME=function(a,b){Fc[a]=b};k.resolveMode=function(a){if("string"==typeof a&&Fc.hasOwnProperty(a))a=Fc[a];else if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a))return k.resolveMode("application/xml");
return"string"==typeof a?{name:a}:a||{name:"null"}};k.getMode=function(a,b){b=k.resolveMode(b);var c=Cd[b.name];if(!c)return k.getMode(a,"text/plain");c=c(a,b);if(vb.hasOwnProperty(b.name)){var e=vb[b.name],g;for(g in e)e.hasOwnProperty(g)&&(c.hasOwnProperty(g)&&(c["_"+g]=c[g]),c[g]=e[g])}c.name=b.name;return c};k.defineMode("null",function(){return{token:function(a){a.skipToEnd()}}});k.defineMIME("text/plain","null");var vb=k.modeExtensions={};k.extendMode=function(a,b){var c=vb.hasOwnProperty(a)?
vb[a]:vb[a]={};Sb(b,c)};k.defineExtension=function(a,b){k.prototype[a]=b};k.defineDocExtension=function(a,b){ca.prototype[a]=b};k.defineOption=I;var hc=[];k.defineInitHook=function(a){hc.push(a)};k.copyState=Va;k.startState=Sc;k.innerMode=function(a,b){for(;a.innerMode;){var c=a.innerMode(b);b=c.state;a=c.mode}return c||{mode:a,state:b}};var nc=k.commands={selectAll:function(a){a.setSelection(z(a.firstLine(),0),z(a.lastLine()))},killLine:function(a){var b=a.getCursor(!0),c=a.getCursor(!1),e=!N(b,
c);!e&&a.getLine(b.line).length==b.ch?a.replaceRange("",b,z(b.line+1,0),"+delete"):a.replaceRange("",b,e?c:z(b.line),"+delete")},deleteLine:function(a){var b=a.getCursor().line;a.replaceRange("",z(b,0),z(b),"+delete")},undo:function(a){a.undo()},redo:function(a){a.redo()},goDocStart:function(a){a.extendSelection(z(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(z(a.lastLine()))},goLineStart:function(a){a.extendSelection(Bd(a,a.getCursor().line))},goLineStartSmart:function(a){var b=a.getCursor(),
c=Bd(a,b.line),e=a.getLineHandle(c.line),g=na(e);!g||0==g[0].level?(e=Math.max(0,e.text.search(/\S/)),a.extendSelection(z(c.line,b.line==c.line&&b.ch<=e&&b.ch?0:e))):a.extendSelection(c)},goLineEnd:function(a){a.extendSelection(Zd(a,a.getCursor().line))},goLineRight:function(a){var b=a.charCoords(a.getCursor(),"div").top+5;a.extendSelection(a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:b},"div"))},goLineLeft:function(a){var b=a.charCoords(a.getCursor(),"div").top+5;a.extendSelection(a.coordsChar({left:0,
top:b},"div"))},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,"char")},goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,"word")},goGroupRight:function(a){a.moveH(1,"group")},goGroupLeft:function(a){a.moveH(-1,"group")},goWordRight:function(a){a.moveH(1,
"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},delWordAfter:function(a){a.deleteH(1,"word")},delGroupBefore:function(a){a.deleteH(-1,"group")},delGroupAfter:function(a){a.deleteH(1,"group")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("\t","end",
"+input")},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.replaceSelection("\t","end","+input")},transposeChars:function(a){var b=a.getCursor(),c=a.getLine(b.line);0<b.ch&&b.ch<c.length-1&&a.replaceRange(c.charAt(b.ch)+c.charAt(b.ch-1),z(b.line,b.ch-1),z(b.line,b.ch+1))},newlineAndIndent:function(a){A(a,function(){a.replaceSelection("\n","end","+input");a.indentLine(a.getCursor().line,null,!0)})()},toggleOverwrite:function(a){a.toggleOverwrite()}},ua=k.keyMap={};ua.basic=
{Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"};ua.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft",
"Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"};ua.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd",
"Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore",fallthrough:["basic","emacsy"]};ua["default"]=Ta?ua.macDefault:ua.pcDefault;ua.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft",
"Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"};k.lookupKey=mb;k.isModifierKey=$c;k.keyName=ad;k.fromTextArea=function(a,b){function c(){a.value=m.getValue()}b||(b={});b.value=a.value;!b.tabindex&&a.tabindex&&(b.tabindex=
a.tabindex);!b.placeholder&&a.placeholder&&(b.placeholder=a.placeholder);if(null==b.autofocus){var e=document.body;try{e=document.activeElement}catch(g){}b.autofocus=e==a||null!=a.getAttribute("autofocus")&&e==document.body}if(a.form&&(H(a.form,"submit",c),!b.leaveSubmitMethodAlone)){var d=a.form,f=d.submit;try{var h=d.submit=function(){c();d.submit=f;d.submit();d.submit=h}}catch(j){}}a.style.display="none";var m=k(function(b){a.parentNode.insertBefore(b,a.nextSibling)},b);m.save=c;m.getTextArea=
function(){return a};m.toTextArea=function(){c();a.parentNode.removeChild(m.getWrapperElement());a.style.display="";a.form&&(ra(a.form,"submit",c),"function"==typeof a.form.submit&&(a.form.submit=f))};return m};ob.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0==this.pos},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(a){var b=this.string.charAt(this.pos);
if("string"==typeof a?b==a:b&&(a.test?a.test(b):a(b)))return++this.pos,b},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){a=this.string.indexOf(a,this.pos);if(-1<a)return this.pos=a,!0},backUp:function(a){this.pos-=a},column:function(){this.lastColumnPos<this.start&&(this.lastColumnValue=
Wa(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start);return this.lastColumnValue},indentation:function(){return Wa(this.string,null,this.tabSize)},match:function(a,b,c){if("string"==typeof a){var e=this.string.substr(this.pos,a.length);if((c?e.toLowerCase():e)==(c?a.toLowerCase():a))return!1!==b&&(this.pos+=a.length),!0}else{if((a=this.string.slice(this.pos).match(a))&&0<a.index)return null;a&&!1!==b&&(this.pos+=a[0].length);return a}},current:function(){return this.string.slice(this.start,
this.pos)}};k.StringStream=ob;k.TextMarker=Ma;Ma.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;b&&qa(a);for(var c=null,e=null,g=0;g<this.lines.length;++g){var f=this.lines[g],h=rb(f.markedSpans,this);null!=h.to&&(e=da(f));for(var j=f,m=f.markedSpans,n=h,k=void 0,p=0;p<m.length;++p)m[p]!=n&&(k||(k=[])).push(m[p]);j.markedSpans=k;null!=h.from?c=da(f):this.collapsed&&(!Ea(this.doc,f)&&a)&&la(f,Y(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(g=
0;g<this.lines.length;++g)f=Sa(a.doc,this.lines[g]),h=d(a.doc,f),h>a.display.maxLineLength&&(a.display.maxLine=f,a.display.maxLineLength=h,a.display.maxLineChanged=!0);null!=c&&a&&S(a,c,e+1);this.lines.length=0;this.explicitlyCleared=!0;this.collapsed&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&id(a));b&&ya(a);ma(this,"clear")}};Ma.prototype.find=function(){for(var a,b,c=0;c<this.lines.length;++c){var e=this.lines[c],g=rb(e.markedSpans,this);if(null!=g.from||null!=g.to)e=da(e),null!=g.from&&(a=z(e,
g.from)),null!=g.to&&(b=z(e,g.to))}return"bookmark"==this.type?a:a&&{from:a,to:b}};Ma.prototype.getOptions=function(a){var b=this.replacedWith;return{className:this.className,inclusiveLeft:this.inclusiveLeft,inclusiveRight:this.inclusiveRight,atomic:this.atomic,collapsed:this.collapsed,replacedWith:a?b&&b.cloneNode(!0):b,readOnly:this.readOnly,startStyle:this.startStyle,endStyle:this.endStyle}};Ma.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;if(!b.maybeHiddenMarkers||
-1==ta(b.maybeHiddenMarkers,this))(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)};Ma.prototype.detachLine=function(a){this.lines.splice(ta(this.lines,a),1);!this.lines.length&&this.doc.cm&&(a=this.doc.cm.curOp,(a.maybeHiddenMarkers||(a.maybeHiddenMarkers=[])).push(this))};k.SharedTextMarker=qb;qb.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();ma(this,"clear")}};qb.prototype.find=
function(){return this.primary.find()};qb.prototype.getOptions=function(a){a=this.primary.getOptions(a);a.shared=!0;return a};var Ec=k.LineWidget=function(a,b,c){for(var e in c)c.hasOwnProperty(e)&&(this[e]=c[e]);this.cm=a;this.node=b};Ec.prototype.clear=qd(function(){var a=this.line.widgets,b=da(this.line);if(null!=b&&a){for(var c=0;c<a.length;++c)a[c]==this&&a.splice(c--,1);a.length||(this.line.widgets=null);la(this.line,Math.max(0,this.line.height-Ab(this)));S(this.cm,b,b+1)}});Ec.prototype.changed=
qd(function(){var a=this.height;this.height=null;if(a=Ab(this)-a)la(this.line,this.line.height+a),a=da(this.line),S(this.cm,a,a+1)});var td={},Ac=/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\uFEFF]/g;Ub.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,e=a+b;c<e;++c){var g=this.lines[c];this.height-=g.height;var d=g;d.parent=null;od(d);ma(g,"delete")}this.lines.splice(a,b)},collapse:function(a){a.splice.apply(a,[a.length,0].concat(this.lines))},insertInner:function(a,
b,c){this.height+=c;this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));a=0;for(c=b.length;a<c;++a)b[a].parent=this},iterN:function(a,b,c){for(b=a+b;a<b;++a)if(c(this.lines[a]))return!0}};tb.prototype={chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var e=this.children[c],g=e.chunkSize();if(a<g){var d=Math.min(b,g-a),f=e.height;e.removeInner(a,d);this.height-=f-e.height;g==d&&(this.children.splice(c--,1),e.parent=
null);if(0==(b-=d))break;a=0}else a-=g}25>this.size-b&&(c=[],this.collapse(c),this.children=[new Ub(c)],this.children[0].parent=this)},collapse:function(a){for(var b=0,c=this.children.length;b<c;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length;this.height+=c;for(var e=0,g=this.children.length;e<g;++e){var d=this.children[e],f=d.chunkSize();if(a<=f){d.insertInner(a,b,c);if(d.lines&&50<d.lines.length){for(;50<d.lines.length;)a=d.lines.splice(d.lines.length-25,25),a=
new Ub(a),d.height-=a.height,this.children.splice(e+1,0,a),a.parent=this;this.maybeSpill()}break}a-=f}},maybeSpill:function(){if(!(10>=this.children.length)){var a=this;do{var b=a.children.splice(a.children.length-5,5),b=new tb(b);if(a.parent){a.size-=b.size;a.height-=b.height;var c=ta(a.parent.children,a);a.parent.children.splice(c+1,0,b)}else c=new tb(a.children),c.parent=a,a.children=[c,b],a=c;b.parent=a.parent}while(10<a.children.length);a.parent.maybeSpill()}},iterN:function(a,b,c){for(var e=
0,g=this.children.length;e<g;++e){var d=this.children[e],f=d.chunkSize();if(a<f){f=Math.min(b,f-a);if(d.iterN(a,f,c))return!0;if(0==(b-=f))break;a=0}else a-=f}}};var ce=0,ca=k.Doc=function(a,b,c){if(!(this instanceof ca))return new ca(a,b,c);null==c&&(c=0);tb.call(this,[new Ub([sb("",null)])]);this.first=c;this.scrollTop=this.scrollLeft=0;this.cantEdit=!1;this.history=Vb();this.frontier=c;c=z(c,0);this.sel={from:c,to:c,head:c,anchor:c,shift:!1,extend:!1,goalColumn:null};this.id=++ce;this.modeOption=
b;"string"==typeof a&&(a=Ja(a));xc(this,{from:c,to:c,text:a},null,{head:c,anchor:c})},de=ca,Dd={iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,e=0,g=b.length;e<g;++e)c+=b[e].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=Bc(this,this.first,this.first+this.size);return!1===a?b:b.join(a||"\n")},setValue:function(a){var b=z(this.first,0),
c=this.first+this.size-1;Xa(this,{from:b,to:z(c,D(this,c).text.length),text:Ja(a),origin:"setValue"},{head:b,anchor:b},!0)},replaceRange:function(a,b,c,e){b=F(this,b);c=c?F(this,c):b;Aa(this,a,b,c,e)},getRange:function(a,b,c){a=wc(this,F(this,a),F(this,b));return!1===c?a:a.join(c||"\n")},getLine:function(a){return(a=this.getLineHandle(a))&&a.text},setLine:function(a,b){ab(this,a)&&Aa(this,b,z(a,0),F(this,z(a)))},removeLine:function(a){a?Aa(this,"",F(this,z(a-1)),F(this,z(a))):Aa(this,"",z(0,0),F(this,
z(1,0)))},getLineHandle:function(a){if(ab(this,a))return D(this,a)},getLineNumber:function(a){return da(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return F(this,a)},getCursor:function(a){var b=this.sel;return Ka(null==a||"head"==a?b.head:"anchor"==a?b.anchor:"end"==a||!1===a?b.to:b.from)},somethingSelected:function(){return!N(this.sel.head,this.sel.anchor)},setCursor:kb(function(a,b,c){a=
F(this,"number"==typeof a?z(a,b||0):a);c?U(this,a):za(this,a,a)}),setSelection:kb(function(a,b){za(this,F(this,a),F(this,b||a))}),extendSelection:kb(function(a,b){U(this,F(this,a),b&&F(this,b))}),getSelection:function(a){return this.getRange(this.sel.from,this.sel.to,a)},replaceSelection:function(a,b,c){Xa(this,{from:this.sel.from,to:this.sel.to,text:Ja(a),origin:c},b||"around")},undo:kb(function(){fd(this,"undo")}),redo:kb(function(){fd(this,"redo")}),setExtending:function(a){this.sel.extend=a},
historySize:function(){var a=this.history;return{undo:a.done.length,redo:a.undone.length}},clearHistory:function(){this.history=Vb()},markClean:function(){this.history.dirtyCounter=0;this.history.lastOp=this.history.lastOrigin=null},isClean:function(){return 0==this.history.dirtyCounter},getHistory:function(){return{done:Wb(this.history.done),undone:Wb(this.history.undone)}},setHistory:function(a){var b=this.history=Vb();b.done=a.done.slice(0);b.undone=a.undone.slice(0)},markText:function(a,b,c){return pb(this,
F(this,a),F(this,b),c,"range")},setBookmark:function(a,b){var c={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft};a=F(this,a);return pb(this,a,a,c,"bookmark")},findMarksAt:function(a){a=F(this,a);var b=[],c=D(this,a.line).markedSpans;if(c)for(var e=0;e<c.length;++e){var g=c[e];if((null==g.from||g.from<=a.ch)&&(null==g.to||g.to>=a.ch))b.push(g.marker.parent||g.marker)}return b},getAllMarks:function(){var a=[];this.iter(function(b){if(b=b.markedSpans)for(var c=0;c<b.length;++c)null!=
b[c].from&&a.push(b[c].marker)});return a},posFromIndex:function(a){var b,c=this.first;this.iter(function(e){e=e.text.length+1;if(e>a)return b=a,!0;a-=e;++c});return F(this,z(c,b))},indexFromPos:function(a){a=F(this,a);var b=a.ch;if(a.line<this.first||0>a.ch)return 0;this.iter(this.first,a.line,function(a){b+=a.text.length+1});return b},copy:function(a){var b=new ca(Bc(this,this.first,this.first+this.size),this.modeOption,this.first);b.scrollTop=this.scrollTop;b.scrollLeft=this.scrollLeft;b.sel={from:this.sel.from,
to:this.sel.to,head:this.sel.head,anchor:this.sel.anchor,shift:this.sel.shift,extend:!1,goalColumn:this.sel.goalColumn};a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory()));return b},linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from);null!=a.to&&a.to<c&&(c=a.to);b=new ca(Bc(this,b,c),a.mode||this.modeOption,b);a.sharedHist&&(b.history=this.history);(this.linked||(this.linked=[])).push({doc:b,sharedHist:a.sharedHist});
b.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}];return b},unlinkDoc:function(a){a instanceof k&&(a=a.doc);if(this.linked)for(var b=0;b<this.linked.length;++b)if(this.linked[b].doc==a){this.linked.splice(b,1);a.unlinkDoc(this);break}if(a.history==this.history){var c=[a.id];$a(a,function(a){c.push(a.id)},!0);a.history=Vb();a.history.done=Wb(this.history.done,c);a.history.undone=Wb(this.history.undone,c)}},iterLinkedDocs:function(a){$a(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm}},
Ed=function(){};Ed.prototype=tb.prototype;var Fd=new Ed;Dd&&Sb(Dd,Fd);de.prototype=Fd;ca.prototype.eachLine=ca.prototype.iter;var ee=["iter","insert","remove","copy","getEditor"],wb;for(wb in ca.prototype)ca.prototype.hasOwnProperty(wb)&&0>ta(ee,wb)&&(k.prototype[wb]=function(a){return function(){return a.apply(this.doc,arguments)}}(ca.prototype[wb]));k.e_stop=eb;k.e_preventDefault=T;k.e_stopPropagation=zd;var xa,Db=0;k.on=H;k.off=ra;k.signal=X;var cb=30,Wc=k.Pass={toString:function(){return"CodeMirror.Pass"}};
bc.prototype={set:function(a,b){clearTimeout(this.id);this.id=setTimeout(b,a)}};k.countColumn=Wa;var Yb=[""],Yd=/[\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc]/,kc=/[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\uA66F\uA670-\uA672\uA674-\uA67D\uA69F\udc00-\udfff]/;k.replaceGetRect=function(a){Q=a};var mc;if(ha)mc=!1;else{var Gd=C("div");mc="draggable"in Gd||"dragDrop"in
Gd}var Tb=/^$/;Za?Tb=/$'/:gc&&!/Version\/([6-9]|\d\d)\b/.test(navigator.userAgent)?Tb=/\-[^ \-?]|\?[^ !'\"\),.\-\/:;\?\]\}]/:fa&&(Tb=/[~!#%&*)=+}\]|\"\.>,:;][({[<]|-[^\-?\.]|\?[\w~`@#$%\^&*(_=+{[|><]/);var Zb,Cc,Ja=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],e=a.length;b<=e;){var g=a.indexOf("\n",b);-1==g&&(g=a.length);var d=a.slice(b,"\r"==a.charAt(g-1)?g-1:g),f=d.indexOf("\r");-1!=f?(c.push(d.slice(0,f)),b+=f+1):(c.push(d),b=g+1)}return c}:function(a){return a.split(/\r\n?|\n/)};
k.splitLines=Ja;var Sd=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(b){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(c){}return!b||b.parentElement()!=a?!1:0!=b.compareEndPoints("StartToEnd",b)},Hb;var Gc=C("div");"oncopy"in Gc?Hb=!0:(Gc.setAttribute("oncopy","return;"),Hb="function"==typeof Gc.oncopy);var La={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",
34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};k.keyNames=La;for(var W=0;10>W;W++)La[W+48]=String(W);for(W=65;90>=W;W++)La[W]=String.fromCharCode(W);
for(W=1;12>=W;W++)La[W+111]=La[W+63235]="F"+W;var wd,he=function(a){return 255>=a?fe.charAt(a):1424<=a&&1524>=a?"R":1536<=a&&1791>=a?ge.charAt(a-1536):1792<=a&&2220>=a?"r":"L"},fe="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLL",ge="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmmrrrrrrrrrrrrrrrrrr",
ie=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,Hd=/[stwN]/,Id=/[LRr]/,Jd=/[Lb1n]/,Kd=/[1n]/;wd=function(a){if(!ie.test(a))return!1;for(var b=a.length,c=[],e=0,g;e<b;++e)c.push(he(a.charCodeAt(e)));for(var e=0,d="L";e<b;++e)g=c[e],"m"==g?c[e]=d:d=g;e=0;for(d="L";e<b;++e)g=c[e],"1"==g&&"r"==d?c[e]="n":Id.test(g)&&(d=g,"r"==g&&(c[e]="R"));e=1;for(d=c[0];e<b-1;++e){g=c[e];if("+"==g&&"1"==d&&"1"==c[e+1])c[e]="1";else if(","==g&&d==c[e+1]&&("1"==d||"n"==d))c[e]=d;d=g}for(e=0;e<b;++e)if(g=c[e],","==g)c[e]=
"N";else if("%"==g){for(d=e+1;d<b&&"%"==c[d];++d);var f=e&&"!"==c[e-1]||d<b-1&&"1"==c[d]?"1":"N";for(g=e;g<d;++g)c[g]=f;e=d-1}e=0;for(d="L";e<b;++e)g=c[e],"L"==d&&"1"==g?c[e]="L":Id.test(g)&&(d=g);for(e=0;e<b;++e)if(Hd.test(c[e])){for(d=e+1;d<b&&Hd.test(c[d]);++d);g="L"==(d<b-1?c[d]:"L");f="L"==(e?c[e-1]:"L")||g?"L":"R";for(g=e;g<d;++g)c[g]=f;e=d-1}for(var d=[],h,e=0;e<b;)if(Jd.test(c[e])){g=e;for(++e;e<b&&Jd.test(c[e]);++e);d.push({from:g,to:e,level:0})}else{var j=e,f=d.length;for(++e;e<b&&"L"!=
c[e];++e);for(g=j;g<e;)if(Kd.test(c[g])){j<g&&d.splice(f,0,{from:j,to:g,level:1});j=g;for(++g;g<e&&Kd.test(c[g]);++g);d.splice(f,0,{from:j,to:g,level:2});j=g}else++g;j<e&&d.splice(f,0,{from:j,to:e,level:1})}if(1==d[0].level&&(h=a.match(/^\s+/)))d[0].from=h[0].length,d.unshift({from:0,to:h[0].length,level:0});if(1==$(d).level&&(h=a.match(/\s+$/)))$(d).to-=h[0].length,d.push({from:b-h[0].length,to:b,level:0});d[0].level!=$(d).level&&d.push({from:b,to:b,level:d[0].level});return d};k.version="3.12";
return k}();CodeMirror.showHint=function(k,x,t){function u(){if(!k.somethingSelected())if(t.async)x(k,p,t);else return p(x(k,t))}function r(d){return"string"==typeof d?d:d.text}function p(f){function h(d){d=Math.max(0,Math.min(d,M.length-1));if(O!=d){var h=B.childNodes[O];h.className=h.className.replace(" CodeMirror-hint-active","");h=B.childNodes[O=d];h.className+=" CodeMirror-hint-active";h.offsetTop<B.scrollTop?B.scrollTop=h.offsetTop-3:h.offsetTop+h.offsetHeight>B.scrollTop+B.clientHeight&&(B.scrollTop=h.offsetTop+
h.offsetHeight-B.clientHeight+3);CodeMirror.signal(f,"select",M[O],h)}}function p(){ea=setTimeout(s,100)}function w(){clearTimeout(ea)}function n(){var d=k.getScrollInfo(),f=k.getWrapperElement().getBoundingClientRect(),h=ja+sa.top-d.top,j=h;jb||(j+=B.offsetHeight);if(j<=f.top||j>=f.bottom)return s();B.style.top=h+"px";B.style.left=Ha+sa.left-d.left+"px"}function s(d){Y||(Y=!0,clearTimeout(Ra),B.parentNode.removeChild(B),k.removeKeyMap(pa),k.off("cursorActivity",x),k.off("blur",p),k.off("focus",w),
k.off("scroll",n),!0!==d&&CodeMirror.signal(f,"close"))}function E(){var d=k,h=f,j=M[O];j.hint?j.hint(d,h,j):d.replaceRange(r(j),h.from,h.to);s()}function x(){clearTimeout(Ra);var f=k.getCursor(),h=k.getLine(f.line);f.line!=qa.line||h.length-f.ch!=ya-qa.ch||f.ch<j||k.somethingSelected()||f.ch&&m.test(h.charAt(f.ch-1))?s():Ra=setTimeout(function(){s(!0);d=!0;u()},70)}if(f&&f.list.length){var M=f.list;if(!d&&!1!==t.completeSingle&&1==M.length){var aa=k,G=f,L=M[0];L.hint?L.hint(aa,G,L):aa.replaceRange(r(L),
G.from,G.to);CodeMirror.signal(f,"close");return!0}var B=document.createElement("ul"),O=0;B.className="CodeMirror-hints";for(G=0;G<M.length;++G){var L=B.appendChild(document.createElement("li")),K=M[G],J="CodeMirror-hint"+(G?"":" CodeMirror-hint-active");null!=K.className&&(J=K.className+" "+J);L.className=J;K.render?K.render(L,f,K):L.appendChild(document.createTextNode(K.displayText||r(K)));L.hintId=G}var G=k.cursorCoords(!1!==t.alignWithWord?f.from:null),Ha=G.left,ja=G.bottom,jb=!0;B.style.left=
Ha+"px";B.style.top=ja+"px";document.body.appendChild(B);CodeMirror.signal(f,"shown");var Z=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),L=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight),K=B.getBoundingClientRect(),V=K.right-Z,J=K.bottom-L;0<V&&(K.right-K.left>Z&&(B.style.width=Z-5+"px",V-=K.right-K.left-Z),B.style.left=(Ha=G.left-V)+"px");0<J&&(Z=K.bottom-K.top,0<K.top-(G.bottom-G.top)-Z?(J=Z+(G.bottom-
G.top),jb=!1):Z>L&&(B.style.height=L-5+"px",J-=Z-L),B.style.top=(ja=G.bottom-J)+"px");var pa,G={Up:function(){h(O-1)},Down:function(){h(O+1)},PageUp:function(){h(O-(Math.floor(B.clientHeight/B.firstChild.offsetHeight)||1))},PageDown:function(){h(O+(Math.floor(B.clientHeight/B.firstChild.offsetHeight)||1))},Home:function(){h(0)},End:function(){h(M.length-1)},Enter:E,Tab:E,Esc:s};if(t.customKeys)for(aa in pa={},t.customKeys)t.customKeys.hasOwnProperty(aa)&&(L=t.customKeys[aa],G.hasOwnProperty(L)&&(L=
G[L]),pa[aa]=L);else pa=G;k.addKeyMap(pa);k.on("cursorActivity",x);var ea;k.on("blur",p);k.on("focus",w);var sa=k.getScrollInfo();k.on("scroll",n);CodeMirror.on(B,"dblclick",function(d){d=d.target||d.srcElement;null!=d.hintId&&(O=d.hintId,E())});CodeMirror.on(B,"click",function(d){d=d.target||d.srcElement;null!=d.hintId&&h(d.hintId)});CodeMirror.on(B,"mousedown",function(){setTimeout(function(){k.focus()},20)});var Y=!1,Ra,qa=k.getCursor(),ya=k.getLine(qa.line).length;CodeMirror.signal(f,"select",
M[0],B.firstChild);return!0}}t||(t={});var j=k.getCursor().ch,d=!1,m=t.closeCharacters||/[\s()\[\]{};:]/;return u()};(function(){function k(k){"activeLine"in k.state&&(k.removeLineClass(k.state.activeLine,"wrap",t),k.removeLineClass(k.state.activeLine,"background",u))}function x(r){var p=r.getLineHandle(r.getCursor().line);r.state.activeLine!=p&&(k(r),r.addLineClass(p,"wrap",t),r.addLineClass(p,"background",u),r.state.activeLine=p)}var t="CodeMirror-activeline",u="CodeMirror-activeline-background";CodeMirror.defineOption("styleActiveLine",!1,function(r,p,j){j=j&&j!=CodeMirror.Init;p&&!j?(x(r),r.on("cursorActivity",
x)):!p&&j&&(r.off("cursorActivity",x),k(r),delete r.state.activeLine)})})();(function(){function k(k){for(var u={name:"autoCloseBrackets",Backspace:function(j){if(j.somethingSelected())return CodeMirror.Pass;var d=j.getCursor(),m=j.getLine(d.line);if(d.ch&&d.ch<m.length&&0==k.indexOf(m.slice(d.ch-1,d.ch+1))%2)j.replaceRange("",CodeMirror.Pos(d.line,d.ch-1),CodeMirror.Pos(d.line,d.ch+1));else return CodeMirror.Pass}},r=[],p=0;p<k.length;p+=2)(function(j,d){function m(f){var h=f.getCursor();if(f.getRange(h,CodeMirror.Pos(h.line,h.ch+1))!=d||f.somethingSelected())return CodeMirror.Pass;
f.execCommand("goCharRight")}j!=d&&r.push(d);u["'"+j+"'"]=function(f){if("'"==j&&"comment"==f.getTokenAt(f.getCursor()).type)return CodeMirror.Pass;if(f.somethingSelected()){var h=f.getSelection();f.replaceSelection(j+h+d)}else if(!(j==d&&m(f)!=CodeMirror.Pass)){var h=f.getCursor(),k=CodeMirror.Pos(h.line,h.ch+1),p=f.getLine(h.line),n=p.charAt(h.ch);if(p.length==h.ch||0<=r.indexOf(n)||x.test(n))f.replaceSelection(j+d,{head:k,anchor:k});else return CodeMirror.Pass}};j!=d&&(u["'"+d+"'"]=m)})(k.charAt(p),
k.charAt(p+1));return u}var x=/\s/;CodeMirror.defineOption("autoCloseBrackets",!1,function(t,u,r){r=r&&r!=CodeMirror.Init;u&&!r?t.addKeyMap(k("string"==typeof u?u:"()[]{}''\"\"")):!u&&r&&t.removeKeyMap("autoCloseBrackets")})})();(function(){function k(k){var r=k.getCursor(),p=k.getTokenAt(r),j=CodeMirror.innerMode(k.getMode(),p.state).mode,d;if("comment"==p.type&&j.blockCommentStart){var m=p.string.indexOf(j.blockCommentEnd),r=k.getRange(CodeMirror.Pos(r.line,0),CodeMirror.Pos(r.line,p.end)),f;if(!(-1!=m&&m==p.string.length-j.blockCommentEnd.length))if(0==p.string.indexOf(j.blockCommentStart)){if(d=r.slice(0,p.start),!/^\s*$/.test(d)){d="";for(m=0;m<p.start;++m)d+=" "}}else if(-1!=(f=r.indexOf(j.blockCommentContinue))&&f+
j.blockCommentContinue.length>p.start&&/^\s*$/.test(r.slice(0,f)))d=r.slice(0,f)}if(null!=d)k.replaceSelection("\n"+d+j.blockCommentContinue,"end");else return CodeMirror.Pass}for(var x=["clike","css","javascript"],t=0;t<x.length;++t)CodeMirror.extendMode(x[t],{blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * "});CodeMirror.defineOption("continueComments",null,function(u,r,p){p&&p!=CodeMirror.Init&&u.removeKeyMap("continueComment");p={name:"continueComment"};p["string"==typeof r?
r:"Enter"]=k;u.addKeyMap(p)})})();(function(){function k(d){d.operation(function(){var f=d.getCursor("start"),h=d.getCursor("end");if(0==t(f,h))r(d);else{var k=d.state.markedSelection;if(k.length){var w=k[0].find(),n=k[k.length-1].find();if(!w||!n||h.line-f.line<j||0<=t(f,n.to)||0>=t(h,w.from))p(d);else{for(;0<t(f,w.from);)k.shift().clear(),w=k[0].find();0>t(f,w.from)&&(w.to.line-f.line<j?(k.shift().clear(),u(d,f,w.to,0)):u(d,f,w.from,0));for(;0>t(h,n.to);)k.pop().clear(),n=k[k.length-1].find();0<t(h,n.to)&&(h.line-n.from.line<j?
(k.pop().clear(),u(d,n.from,h)):u(d,n.to,h))}}else u(d,f,h)}})}function x(d){d.state.markedSelection.length&&d.operation(function(){r(d)})}function t(d,f){return d.line-f.line||d.ch-f.ch}function u(m,f,h,k){if(0!=t(f,h))for(var p=m.state.markedSelection,n=m.state.markedSelectionStyle,s=f.line;;){var E=s==f.line?f:d(s,0),s=s+j,r=s>=h.line,u=r?h:d(s,0),E=m.markText(E,u,{className:n});null==k?p.push(E):p.splice(k++,0,E);if(r)break}}function r(d){d=d.state.markedSelection;for(var f=0;f<d.length;++f)d[f].clear();
d.length=0}function p(d){r(d);var f=d.getCursor("start"),h=d.getCursor("end");u(d,f,h)}CodeMirror.defineOption("styleSelectedText",!1,function(d,f,h){h=h&&h!=CodeMirror.Init;f&&!h?(d.state.markedSelection=[],d.state.markedSelectionStyle="string"==typeof f?f:"CodeMirror-selectedtext",p(d),d.on("cursorActivity",k),d.on("change",x)):!f&&h&&(d.off("cursorActivity",k),d.off("change",x),r(d),d.state.markedSelection=d.state.markedSelectionStyle=null)});var j=8,d=CodeMirror.Pos})();(function(){function k(d){function j(h,m,n){if(h.text){var k=s?0:h.text.length-1,y=s?h.text.length:-1;if(h.text.length>f)return null;var w=1E3>h.text.length;for(null!=n&&(k=n+E);k!=y;k+=E)if(n=h.text.charAt(k),x.test(n)&&(!w||d.getTokenAt(r(m,k+1)).type==u)){var G=p[n];if(">"==G.charAt(1)==s)t.push(n);else{if(t.pop()!=G.charAt(0))return{pos:k,match:!1};if(!t.length)return{pos:k,match:!0}}}}}var f=d.state._matchBrackets.maxScanLineLength||1E4,h=d.getCursor(),k=d.getLineHandle(h.line),w=h.ch-1,n=0<=
w&&p[k.text.charAt(w)]||p[k.text.charAt(++w)];if(!n)return null;for(var s=">"==n.charAt(1),E=s?1:-1,u=d.getTokenAt(r(h.line,w+1)).type,t=[k.text.charAt(w)],x=/[(){}[\]]/,n=h.line,G,L=s?Math.min(n+100,d.lineCount()):Math.max(-1,n-100);n!=L&&!(G=n==h.line?j(k,n,w):j(d.getLineHandle(n),n));n+=E);return{from:r(h.line,w),to:G&&r(n,G.pos),match:G&&G.match}}function x(d,j){var f=d.state._matchBrackets.maxHighlightLineLength||1E3,h=k(d);if(h&&!(d.getLine(h.from.line).length>f||h.to&&d.getLine(h.to.line).length>
f)){var f=h.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",p=d.markText(h.from,r(h.from.line,h.from.ch+1),{className:f}),w=h.to&&d.markText(h.to,r(h.to.line,h.to.ch+1),{className:f});u&&d.state.focused&&d.display.input.focus();h=function(){d.operation(function(){p.clear();w&&w.clear()})};if(j)setTimeout(h,800);else return h}}function t(d){d.operation(function(){j&&(j(),j=null);d.somethingSelected()||(j=x(d,!1))})}var u=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||
8>document.documentMode),r=CodeMirror.Pos,p={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},j=null;CodeMirror.defineOption("matchBrackets",!1,function(d,j,f){f&&f!=CodeMirror.Init&&d.off("cursorActivity",t);j&&(d.state._matchBrackets="object"==typeof j?j:{},d.on("cursorActivity",t))});CodeMirror.defineExtension("matchBrackets",function(){x(this,!0)});CodeMirror.defineExtension("findMatchingBracket",function(){return k(this)})})();(function(){function k(k){this.minChars="object"==typeof k&&k.minChars||u;this.style="object"==typeof k&&k.style||r;this.overlay=null}function x(k){k.operation(function(){var j=k.state.matchHighlighter;j.overlay&&(k.removeOverlay(j.overlay),j.overlay=null);if(k.somethingSelected()){var d=k.getSelection().replace(/^\s+|\s+$/g,"");d.length<j.minChars||k.addOverlay(j.overlay=t(d,j.style))}})}function t(k,j){return{token:function(d){if(d.match(k))return j;d.next();d.skipTo(k.charAt(0))||d.skipToEnd()}}}
var u=2,r="matchhighlight";CodeMirror.defineOption("highlightSelectionMatches",!1,function(p,j,d){d=d&&d!=CodeMirror.Init;j&&!d?(p.state.matchHighlighter=new k(j),p.on("cursorActivity",x)):!j&&d&&((j=p.state.matchHighlighter.overlay)&&p.removeOverlay(j),p.state.matchHighlighter=null,p.off("cursorActivity",x))})})();(function(){function k(k){k.state.placeholder&&(k.state.placeholder.parentNode.removeChild(k.state.placeholder),k.state.placeholder=null)}function x(p){k(p);var j=p.state.placeholder=document.createElement("pre");j.style.cssText="height: 0; overflow: visible";j.className="CodeMirror-placeholder";j.appendChild(document.createTextNode(p.getOption("placeholder")));p.display.lineSpace.insertBefore(j,p.display.lineSpace.firstChild)}function t(p){k(p)}function u(k){1===k.lineCount()&&""===k.getLine(0)&&
x(k)}function r(p){var j=p.getWrapperElement(),d=1===p.lineCount()&&""===p.getLine(0);j.className=j.className.replace(" CodeMirror-empty","")+(d?" CodeMirror-empty":"");p.hasFocus()||(d?x(p):k(p))}CodeMirror.defineOption("placeholder","",function(p,j,d){d=d&&d!=CodeMirror.Init;j&&!d?(p.on("focus",t),p.on("blur",u),p.on("change",r),r(p)):!j&&d&&(p.off("focus",t),p.off("blur",u),p.off("change",r),k(p),d=p.getWrapperElement(),d.className=d.className.replace(" CodeMirror-empty",""));j&&!p.hasFocus()&&
u(p)})})();(function(k,x,t,u,r){k.Loader.addComponent(function(k){k.extend(k,{string:{parseVariables:function(j,d){d=d||{};return j.replace(/\{(\$?[\w\d]+)\}/gi,function(j,f){var h="$"===f.substr(0,1);h&&(f=f.substr(1));return null===d[f]?"":d[f]!==r?d[f]:!h?"{"+f+"}":""})},trim:function(j,d){var k,f=0,h=0;k=d?(d+"").replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,"$1"):" \n\r\t\f\x0B\u00a0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000";f=j.length;for(h=0;h<f;h++)if(-1===
k.indexOf(j.charAt(h))){j=j.substring(h);break}f=j.length;for(h=f-1;0<=h;h--)if(-1===k.indexOf(j.charAt(h))){j=j.substring(0,h+1);break}return-1===k.indexOf(j.charAt(0))?j:""}},number:{format:function(j,d,k,f){d=d===r?2:d;k=k||".";f=f||",";j=j.toString().replace(/[^0-9+\-Ee.]/g,"");j=!isFinite(+j)?0:+j;d=!isFinite(+d)?0:u.abs(d);var h="",h=function(d,f){var h=u.pow(10,f);return""+u.round(d*h)/h},h=(d?h(j,d):""+u.round(j)).split(".");3<h[0].length&&(h[0]=h[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,f));
if((h[1]||"").length<d)h[1]=h[1]||"",h[1]+=Array(d-h[1].length+1).join("0");return h.join(k)}}})})})(CSDLEditor,window,document,Math);(function(k,x,t,u,r){k.Loader.addComponent(function(k){k.fn.extend({simulate:function(j,d){return this.each(function(){var m=k.extend({},k.simulate.defaults,d||{});new k.simulate(this,j,m)})}});k.simulate=function(j,d,k){this.target=j;this.options=k;/^drag$/.test(d)?this[d].apply(this,[this.target,k]):this.simulateEvent(j,d,k)};k.extend(k.simulate.prototype,{simulateEvent:function(j,d,k){var f=this.createEvent(d,k);this.dispatchEvent(j,d,f,k);return f},createEvent:function(j,d){if(/^mouse(over|out|down|up|move)|(dbl)?click$/.test(j))return this.mouseEvent(j,
d);if(/^key(up|down|press)$/.test(j))return this.keyboardEvent(j,d)},mouseEvent:function(j,d){var m,f=k.extend({bubbles:!0,cancelable:"mousemove"!=j,view:t,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:r},d);k(f.relatedTarget);k.isFunction(u.createEvent)?(m=u.createEvent("MouseEvents"),m.initMouseEvent(j,f.bubbles,f.cancelable,f.view,f.detail,f.screenX,f.screenY,f.clientX,f.clientY,f.ctrlKey,f.altKey,f.shiftKey,f.metaKey,f.button,
f.relatedTarget||u.body.parentNode)):u.createEventObject&&(m=u.createEventObject(),k.extend(m,f),m.button={"0":1,1:4,2:2}[m.button]||m.button);return m},keyboardEvent:function(j,d){var m,f=k.extend({bubbles:!0,cancelable:!0,view:t,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:0,charCode:0},d);if(k.isFunction(u.createEvent))try{m=u.createEvent("KeyEvents"),m.initKeyEvent(j,f.bubbles,f.cancelable,f.view,f.ctrlKey,f.altKey,f.shiftKey,f.metaKey,f.keyCode,f.charCode)}catch(h){m=u.createEvent("Events"),
m.initEvent(j,f.bubbles,f.cancelable),k.extend(m,{view:f.view,ctrlKey:f.ctrlKey,altKey:f.altKey,shiftKey:f.shiftKey,metaKey:f.metaKey,keyCode:f.keyCode,charCode:f.charCode})}else u.createEventObject&&(m=u.createEventObject(),k.extend(m,f));k("html").is(".msie")&&(m.keyCode=0<f.charCode?f.charCode:f.keyCode,m.charCode=r);return m},dispatchEvent:function(j,d,k){j.dispatchEvent?j.dispatchEvent(k):j.fireEvent&&j.fireEvent("on"+d,k);return k},drag:function(){var j=this.findCenter(this.target),d=this.options,
k=x.floor(j.x),j=x.floor(j.y),f=d.dx||0,d=d.dy||0,h=this.target,p={clientX:k,clientY:j};this.simulateEvent(h,"mousedown",p);p={clientX:k+1,clientY:j+1};this.simulateEvent(u,"mousemove",p);p={clientX:k+f,clientY:j+d};this.simulateEvent(u,"mousemove",p);this.simulateEvent(u,"mousemove",p);this.simulateEvent(h,"mouseup",p)},findCenter:function(j){j=k(this.target);var d=j.offset();return{x:d.left+j.outerWidth()/2,y:d.top+j.outerHeight()/2}}});k.extend(k.simulate,{defaults:{speed:"sync"},VK_TAB:9,VK_ENTER:13,
VK_ESC:27,VK_PGUP:33,VK_PGDN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40})})})(CSDLEditor,Math,window,document);(function(){function k(d,f,h){d.addEventListener?d.addEventListener(f,h,!1):d.attachEvent("on"+f,h)}function x(d){if("keypress"==d.type){var f=String.fromCharCode(d.which);d.shiftKey||(f=f.toLowerCase());return f}return h[d.which]?h[d.which]:y[d.which]?y[d.which]:String.fromCharCode(d.which).toLowerCase()}function t(d){d=d||{};var f=!1,h;for(h in M)d[h]?f=!0:M[h]=0;f||(L=!1)}function u(f,h,j,k,n){var m,s,p=[],y=j.type;if(!E[f])return[];"keyup"==y&&d(f)&&(h=[f]);for(m=0;m<E[f].length;++m)if(s=E[f][m],
!(s.seq&&M[s.seq]!=s.level)&&y==s.action&&("keypress"==y&&!j.metaKey&&!j.ctrlKey||h.sort().join(",")===s.modifiers.sort().join(",")))k&&s.combo==n&&E[f].splice(m,1),p.push(s);return p}function r(d){var f=[];d.shiftKey&&f.push("shift");d.altKey&&f.push("alt");d.ctrlKey&&f.push("ctrl");d.metaKey&&f.push("meta");return f}function p(d,f,h){if(!O.stopCallback(f,f.target||f.srcElement,h)&&!1===d(f,h))f.preventDefault&&f.preventDefault(),f.stopPropagation&&f.stopPropagation(),f.returnValue=!1,f.cancelBubble=
!0}function j(d){"number"!==typeof d.which&&(d.which=d.keyCode);var f=x(d);f&&("keyup"==d.type&&G==f?G=!1:O.handleKey(f,r(d),d))}function d(d){return"shift"==d||"ctrl"==d||"alt"==d||"meta"==d}function m(d,f,j){if(!j){if(!s){s={};for(var k in h)95<k&&112>k||h.hasOwnProperty(k)&&(s[h[k]]=k)}j=s[d]?"keydown":"keypress"}"keypress"==j&&f.length&&(j="keydown");return j}function f(h,j,k,s,y){Ga[h+":"+k]=j;h=h.replace(/\s+/g," ");var r=h.split(" "),B,O,ea=[];if(1<r.length){var sa=h,Y=k;M[sa]=0;Y||(Y=m(r[0],
[]));h=function(){L=Y;++M[sa];clearTimeout(aa);aa=setTimeout(t,1E3)};k=function(d){p(j,d,sa);"keyup"!==Y&&(G=x(d));setTimeout(t,10)};for(s=0;s<r.length;++s)f(r[s],s<r.length-1?h:k,Y,sa,s)}else{O="+"===h?["+"]:h.split("+");for(r=0;r<O.length;++r)B=O[r],n[B]&&(B=n[B]),k&&"keypress"!=k&&w[B]&&(B=w[B],ea.push("shift")),d(B)&&ea.push(B);k=m(B,ea,k);E[B]||(E[B]=[]);u(B,ea,{type:k},!s,h);E[B][s?"unshift":"push"]({callback:j,modifiers:ea,action:k,seq:s,level:y,combo:h})}}for(var h={8:"backspace",9:"tab",
13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},y={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},w={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},n={option:"alt",
command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},s,E={},Ga={},M={},aa,G=!1,L=!1,B=1;20>B;++B)h[111+B]="f"+B;for(B=0;9>=B;++B)h[B+96]=B;k(document,"keypress",j);k(document,"keydown",j);k(document,"keyup",j);var O={bind:function(d,h,j){d=d instanceof Array?d:[d];for(var k=0;k<d.length;++k)f(d[k],h,j);return this},unbind:function(d,f){return O.bind(d,function(){},f)},trigger:function(d,f){if(Ga[d+":"+f])Ga[d+":"+f]({},d);return this},reset:function(){E=
{};Ga={};return this},stopCallback:function(d,f){return-1<(" "+f.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==f.tagName||"SELECT"==f.tagName||"TEXTAREA"==f.tagName||f.contentEditable&&"true"==f.contentEditable},handleKey:function(f,h,j){h=u(f,h,j);var k,n={},m=0,s=!1;for(k=0;k<h.length;++k)h[k].seq&&(m=Math.max(m,h[k].level));for(k=0;k<h.length;++k)h[k].seq?h[k].level==m&&(s=!0,n[h[k].seq]=1,p(h[k].callback,j,h[k].combo)):s||p(h[k].callback,j,h[k].combo);j.type==L&&!d(f)&&t(n)}};window.Mousetrap=
O;"function"===typeof define&&define.amd&&define(O)})();(function(k,x){var t={},u={},r={},p={},j=function(f,h){var k=f.next();f.peek();h.type=null;if(k===x)return null;if("("===k||"{"===k)return h.type="openbracket";if(")"===k||"}"===k)return h.type="closebracket";if('"'===k||"'"===k)return h.type="string",h.tokenize=function(d,f){for(var h=!1,m;null!==(m=d.next())&&m!==x;){if(m===k&&!h){f.tokenize=j;break}h=!h&&"\\"===m}return"string"},h.tokenize(f,h);if("/"===k&&f.eat("/"))return h.type="comment",f.skipToEnd(),"comment";if("/"===k&&f.eat("*"))return h.tokenize=
d,h.tokenize(f,h);if(47<k.charCodeAt(0)&&58>k.charCodeAt(0)&&!/^[\w]$/.test(f.peek()))return f.match(/^[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/),h.type="number";if("."===k&&f.match(/^[0-9eE]+/))return h.type="number";f.eatWhile(/^[^\s\(\)\{\}]/);var m=f.current().toLowerCase();return t.hasOwnProperty(m)?"target":u.hasOwnProperty(m)?"operator":r.hasOwnProperty(m)?"logical":p.hasOwnProperty(m)?"keyword":null},d=function(d,h){for(;;)if(h.type="comment",d.skipTo("*")){if(d.next(),d.eat("/")){h.type=null;h.tokenize=
j;break}}else{d.skipToEnd();break}return"comment"},m=function(d){if(d===x||null===d||!d||!d.length)return{};var h={},j,k;for(k=0;k<d.length;k++)j=d[k],"string"===typeof j&&(j=j.toLowerCase()),h[j]=!0;return h};k.defineMode("csdl",function(d,h){t=m(h.targets);u=m(h.operators);r=m(h.logical);p=m(h.keywords);return{startState:function(){return{tokenize:j,type:null}},token:function(d,f){if(d.eatSpace())return null;var h=f.tokenize(d,f);if("comment"===h)return h;var j=d.current();"("===j?f.context={prev:f.context,
indent:d.indentation(),col:d.column(),type:")"}:f.context&&f.context.type===j&&(f.indent=f.context.indent,f.context=f.context.prev);return h},indent:function(h,j){var n=h.context;return!n?k.Pass:n.align?n.col+(j.charAt(0)===n.type?0:1):n.indent+d.indentUnit}}});k.defineMIME("text/x-csdl","csdl")})(CodeMirror);(function(k,x,t,u){var r=x.targets,p=x.logical,j=x.operators,d=x.keywords,m=null,f=k.Pos;k.csdlHint=function(h){var y=h.getCursor(),w=h.getTokenAt(y),n=[];if(w.string!==m){m=w.string;if("comment"!==w.state.type&&"string"!==w.state.type&&/^[0-9a-zA-Z_<>=!\.]+$/.test(w.string)){var s=k.getPreviousToken(h,y,w);h=[];var n=[],E=w.string.toLowerCase(),t=E.length;if(s&&("target"===s.type||"operator"===s.type&&"cs"===s.string))h=h.concat(j);if(s&&("operator"===s.type||"string"===s.type||"number"===s.type||
"closebracket"===s.type||"keyword"===s.type))h=h.concat(p);if(s===u||null===s||!s||null===s.type||"openbracket"===s.type||"keyword"===s.type||"logical"===s.type)h=h.concat(r);if(s===u||null===s||!s||null===s.type||"openbracket"===s.type||"closebracket"===s.type)h=h.concat(d);for(s=0;s<h.length;s++)h[s].length!==t&&h[s].substr(0,t)===E&&n.push(h[s]);n.sort()}1===n.length&&n.push(" ");return{list:n,from:f(y.line,w.start),to:f(y.line,w.end)}}}})(CodeMirror,CSDLEditorConfig,Math);(function(k,x){k.Loader.addComponent(function(t){var u=t("body"),r=!1,p=null,j=t.noop,d=[];k.mapsOptions={};k.loadGoogleMaps=function(m,f,h){p=m;j=f;d=h;r?k.mapsInit():(u.append('<script type="text/javascript" src="'+("file:"==x.location.protocol?"http:":"")+"//maps.googleapis.com/maps/api/js?"+(m.options.googleMapsApiKey.length?"key="+m.options.googleMapsApiKey+"&":"")+'libraries=places,geometry&sensor=false&callback=CSDLEditor.mapsInit" />'),r=!0)};k.mapsInit=function(){k.mapsOptions={center:new google.maps.LatLng(40,
0),zoom:1,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControl:!0,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}};google.maps.Polygon.prototype.getBounds||(google.maps.Polygon.prototype.getBounds=function(){var d=new google.maps.LatLngBounds,f=this.getPaths(),h,j,k;for(j=0;j<f.getLength();j++){h=f.getAt(j);for(k=0;k<h.getLength();k++)d.extend(h.getAt(k))}return d});p&&j&&setTimeout(function(){j.apply(p,
d)},210)}})})(CSDLEditor,window);(function(k,x,t){k.Loader.addComponent(function(u){var r=u.number.format,p=function(j){var d=j.data("map"),k=j.find(".csdl-map-search"),f=new google.maps.places.Autocomplete(k[0],{});google.maps.event.addListener(f,"place_changed",function(){var h=f.getPlace();h.geometry===t?0<u(".pac-container .pac-item").length&&(k.trigger("focus"),k.simulate("keydown",{keyCode:40}),k.simulate("keydown",{keyCode:13})):h.geometry.viewport?d.fitBounds(h.geometry.viewport):(d.setCenter(h.geometry.location),d.setZoom(17))})};
k.GeoSelection={};k.GeoSelection.box=function(j,d){this.editor=j;this.$view=d;var m=this,f=new google.maps.Map(d.find(".csdl-map-canvas")[0],k.mapsOptions),h=new google.maps.Rectangle(u.extend({},j.options.mapsOverlay,{})),r=[],w={position:new google.maps.LatLng(0,0),draggable:!0,icon:j.options.mapsMarker},n=[new google.maps.Marker(w),new google.maps.Marker(w)];d.data("map",f).data("rect",h).data("markers",n);d.find(".csdl-map-instructions").html(j.config.geo_box.instructions[0]);p(d);google.maps.event.addListener(f,
"click",function(k){2<=r.length&&r.pop();r.push(k.latLng);var p=r.length-1;n[p].setPosition(k.latLng);d.data("bothMarkersVisible")||n[p].setAnimation(google.maps.Animation.DROP);n[p].setMap(f);2===r.length&&(m.drawRectangle(f,h,r),d.data("bothMarkersVisible",!0));d.find(".csdl-map-instructions").html(j.config.geo_box.instructions[r.length]);d.find(".csdl-clear-map").fadeIn()});google.maps.event.addListener(n[0],"position_changed",function(){r[0]=this.getPosition();m.drawRectangle(f,h,r);2===r.length&&
m.updateInfo(h)});google.maps.event.addListener(n[1],"position_changed",function(){r[1]=this.getPosition();m.drawRectangle(f,h,r);m.updateInfo(h)});d.find(".csdl-clear-map").on("click",function(){r=[];h.setMap(null);n[0].setMap(null);n[1].setMap(null);d.data("bothMarkersVisible",!1);d.find(".csdl-map-area span").html("0 km<sup>2</sup>");d.find(".csdl-map-instructions").html(j.config.geo_box.instructions[0]);u(this).hide();return!1})};k.GeoSelection.box.prototype={setValue:function(j){j=j.split(":");
if(2!==j.length)return!1;var d=this,k=j[0].split(","),f=j[1].split(",");setTimeout(function(){var h=d.$view.data("map"),j=d.$view.data("rect"),p=d.getAllTipsFromNWSE(k,f),n=new google.maps.LatLngBounds(p.sw,p.ne);d.drawRectangleFromBounds(h,j,n);n=d.$view.data("markers");n[0].setMap(h);n[0].setPosition(p.ne);n[1].setMap(h);n[1].setPosition(p.sw);h.fitBounds(j.getBounds());d.updateInfo(j);d.$view.find(".csdl-map-instructions").html(d.editor.config.geo_box.instructions[2]);d.$view.find(".csdl-clear-map").fadeIn()},
400)},getValue:function(){var j=this.$view.data("rect");if(!j.getMap())return"";j=this.getAllTipsFromBounds(j.getBounds());return j.nw.lat()+","+j.nw.lng()+":"+j.se.lat()+","+j.se.lng()},updateInfo:function(j){var d=this;j=this.getAllTipsFromBounds(j.getBounds());var k=google.maps.geometry.spherical.computeArea([j.nw,j.ne,j.se,j.sw]);this.$view.find(".csdl-map-area span").html(r(Math.round(k/1E6))+" km<sup>2</sup>");u.each(j,function(f,h){d.$view.find(".csdl-map-coordinates ."+f+" span").html(r(h.lat(),
2)+", "+r(h.lng(),2))})},drawRectangle:function(j,d,k){if(2!==k.length)return!1;k=this.getAllTipsFromUnspecified(k[0],k[1]);k=new google.maps.LatLngBounds(k.sw,k.ne);this.drawRectangleFromBounds(j,d,k);return!0},drawRectangleFromBounds:function(j,d,k){d.setBounds(k);d.setMap(j)},getAllTipsFromBounds:function(j){var d={};d.ne=j.getNorthEast();d.sw=j.getSouthWest();d.nw=new google.maps.LatLng(d.ne.lat(),d.sw.lng());d.se=new google.maps.LatLng(d.sw.lat(),d.ne.lng());return d},getAllTipsFromNWSE:function(j,
d){var k={};k.nw=new google.maps.LatLng(parseFloat(j[0]),parseFloat(j[1]));k.se=new google.maps.LatLng(parseFloat(d[0]),parseFloat(d[1]));k.ne=new google.maps.LatLng(k.nw.lat(),k.se.lng());k.sw=new google.maps.LatLng(k.se.lat(),k.nw.lng());return k},getAllTipsFromUnspecified:function(j,d){var k,f,h,p;j.lat()>=d.lat()?(k=j,f=d):(k=d,f=j);j.lng()>=d.lng()?(p=j,h=d):(p=d,h=j);return{nw:new google.maps.LatLng(k.lat(),h.lng()),ne:new google.maps.LatLng(k.lat(),p.lng()),se:new google.maps.LatLng(f.lat(),
p.lng()),sw:new google.maps.LatLng(f.lat(),h.lng())}}};k.GeoSelection.radius=function(j,d){this.editor=j;this.$view=d;var m=this,f=new google.maps.Map(d.find(".csdl-map-canvas")[0],k.mapsOptions),h=new google.maps.Circle(j.options.mapsOverlay),r={position:new google.maps.LatLng(0,0),draggable:!0,icon:j.options.mapsMarker},w=new google.maps.Marker(r),n=new google.maps.Marker(r);d.data("map",f).data("circle",h).data("centerMarker",w).data("radiusMarker",n).data("center",!1);d.find(".csdl-map-instructions").html(j.config.geo_radius.instructions[0]);
p(d);google.maps.event.addListener(f,"click",function(k){if(d.data("center")){var p=google.maps.geometry.spherical.computeDistanceBetween(h.getCenter(),k.latLng);h.setRadius(p);h.setMap(f);n.setPosition(k.latLng);n.setMap(f);m.updateInfo(h);d.find(".csdl-map-instructions").html(j.config.geo_radius.instructions[2])}else h.setCenter(k.latLng),w.setPosition(k.latLng),w.setMap(f),d.data("center",!0),d.find(".csdl-map-instructions").html(j.config.geo_radius.instructions[1]);d.find(".csdl-clear-map").fadeIn()});
google.maps.event.addListener(w,"position_changed",function(){var d=this.getPosition(),f=h.getCenter();h.setCenter(d);if(f!==t){var j=d.lat()-f.lat(),d=d.lng()-f.lng(),f=n.getPosition(),j=new google.maps.LatLng(f.lat()+j,f.lng()+d);n.setPosition(j)}});google.maps.event.addListener(n,"position_changed",function(){h.getCenter()!==t&&(h.setRadius(google.maps.geometry.spherical.computeDistanceBetween(h.getCenter(),this.getPosition())),m.updateInfo(h))});d.find(".csdl-clear-map").on("click",function(){h.setCenter(null);
h.setMap(null);w.setMap(null);n.setMap(null);d.data("center",!1);d.find(".csdl-map-area span").html("0 km<sup>2</sup>");d.find(".csdl-map-instructions").html(j.geo_radius.instructions[0]);u(this).hide();return!1})};k.GeoSelection.radius.prototype={setValue:function(j){j=j.split(":");var d=this,k=j[0].split(","),f=1E3*parseFloat(j[1]);setTimeout(function(){var h=d.$view.data("map"),j=d.$view.data("circle"),p=new google.maps.LatLng(k[0],k[1]),n=d.$view.data("centerMarker");n.setPosition(p);n.setMap(h);
var n=d.$view.data("radiusMarker"),s=google.maps.geometry.spherical.computeOffset(p,f,90);n.setPosition(s);n.setMap(h);j.setCenter(p);j.setRadius(f);j.setMap(h);d.$view.data("center",!0);h.fitBounds(j.getBounds());d.updateInfo(j);d.$view.find(".csdl-map-instructions").html(d.editor.config.geo_radius.instructions[2]);d.$view.find(".csdl-clear-map").fadeIn()},200)},getValue:function(){var j=this.$view.data("circle");if(!j.getMap())return"";var d=j.getCenter();return d.lat()+","+d.lng()+":"+j.getRadius()/
1E3},updateInfo:function(j){var d=j.getRadius(),d=d*d*Math.PI,k=j.getCenter();this.$view.find(".csdl-map-area span").html(r(Math.round(d/1E6))+" km<sup>2</sup>");this.$view.find(".csdl-map-coordinates .center span").html(r(k.lat(),2)+", "+r(k.lng(),2));this.$view.find(".csdl-map-coordinates .radius span").html(r(j.getRadius()/1E3,2)+" km")}};k.GeoSelection.polygon=function(j,d){this.editor=j;this.$view=d;var m=this,f=new google.maps.Map(d.find(".csdl-map-canvas")[0],k.mapsOptions),h=u.extend({},j.options.mapsOverlay,
{paths:[[]],editable:!0}),r=new google.maps.Polygon(h),t=r.getPath(),n=new google.maps.MVCArray,s=1;d.data("map",f).data("polygon",r).data("markers",n);p(d);google.maps.event.addListener(f,"click",function(d){t.push(d.latLng)});google.maps.event.addListener(t,"insert_at",function(h){var k=new google.maps.Marker({map:f,position:t.getAt(h),draggable:!0,icon:j.options.mapsMarker,zIndex:s++});n.insertAt(h,k);3<=t.getLength()&&r.setMap(f);h=3>=t.getLength()?t.getLength():3;d.find(".csdl-map-instructions").html(j.config.geo_polygon.instructions[h]);
m.updateInfo(r);d.find(".csdl-clear-map").fadeIn();google.maps.event.addListener(k,"position_changed",function(){var d=m.getMarkerIndex(k,n);-1!==d&&(t.setAt(d,this.getPosition()),m.updateInfo(r))});google.maps.event.addListener(k,"dblclick",function(){var d=m.getMarkerIndex(k,n);-1!==d&&(t.removeAt(d),n.removeAt(d),this.setMap(null),m.updateInfo(r))})});google.maps.event.addListener(t,"set_at",function(d){var f=n.getAt(d);d=t.getAt(d);f.getPosition().equals(d)||f.setPosition(d)});d.find(".csdl-clear-map").on("click",
function(){n.forEach(function(d){d.setMap(null)});n.clear();t.clear();m.updateInfo(r);d.find(".csdl-map-instructions").html(j.config.geo_polygon.instructions[0]);u(this).hide();return!1});d.find(".csdl-map-instructions").html(j.config.geo_polygon.instructions[0])};k.GeoSelection.polygon.prototype={setValue:function(j){var d=this;j=j.split(":");setTimeout(function(){var k=d.$view.data("polygon"),f=d.$view.data("map");u.each(j,function(d,f){f=f.split(",");var j=new google.maps.LatLng(parseFloat(f[0]),
parseFloat(f[1]));k.getPath().push(j)});f.fitBounds(k.getBounds());d.updateInfo(k);d.$view.find(".csdl-map-instructions").html(d.editor.config.geo_polygon.instructions[3]);d.$view.find(".csdl-clear-map").fadeIn()},400)},getValue:function(){var j=[];this.$view.data("polygon").getPath().forEach(function(d){j.push(d.lat()+","+d.lng())});return j.join(":")},getMarkerIndex:function(j,d){var k=-1;d.forEach(function(d,h){d.getZIndex()===j.getZIndex()&&(k=h)});return k},updateInfo:function(j){j=j.getPath();
var d=this.$view.find(".csdl-map-coordinates ul").html("");j.forEach(function(j){u("<li />").html("("+r(j.lat(),4)+", "+r(j.lng(),4)+")").appendTo(d)});3<=j.getLength()?(j=google.maps.geometry.spherical.computeArea(j),this.$view.find(".csdl-map-area span").html(r(Math.round(j/1E6))+" km<sup>2</sup>")):this.$view.find(".csdl-map-area span").html("0 km<sup>2</sup>")}}})})(CSDLEditor,window);(function(k){k.Loader.addComponent(function(){k.Templates={container:'<div class="csdl-container csdl-theme-light"><div class="csdl-maps-marker-url" /><div class="csdl-header" data-bar-top><a href="#" data-undo class="csdl-undo">Undo</a><a href="#" data-redo class="csdl-inactive csdl-redo">Redo</a><a href="#" data-geo class="csdl-inactive csdl-geoselect">Geo - Selection</a><a href="#" data-max class="csdl-view-open"></a><a href="#" data-min class="csdl-view-close" style="display: none;"></a><a href="#" data-theme-dark class="csdl-theme">Dark</a><a href="#" data-theme-light class="csdl-theme" style="display: none;">Light</a><a href="#" class="csdl-save" data-save>Save</a></div><div class="csdl-editor-container" data-editor-container /><div class="csdl-footer" data-bar-bottom><div class="csdl-help" style="display: none;" data-help><span data-help-content /><a href="#" data-help-more>More</a></div></div></div>',
indicator:'<div class="indicator"></div>',popup:'<div class="csdl-overlay" /><div class="csdl-container csdl-popup"><div class="csdl-popup-content"><a href="#" class="csdl-close">&times;</a><h2>{title}</h2><div class="csdl-popup-content-wrap">{content}</div></div></div>',hintHelp:'<div class="csdl-hint-help"><div class="indicator">Loading...</div></div>',geo:'<div class="csdl-map csdl-row"><div class="csdl-column six"><input type="text" name="location" class="csdl-map-search" placeholder="Search for location..." /><div class="csdl-map-canvas" /><a href="#" class="csdl-clear-map">clear coordinates</a></div><div class="csdl-column six"><p class="csdl-map-instructions" /><div class="csdl-map-coordinates" /><div class="csdl-map-area"><label>Area:</label><span>0 km<sup>2</sup></span></div><a href="#" class="csdl-button done" data-done>Done</a><a href="#" class="csdl-button" data-cancel>Cancel</a></div></div>',
geo_box:'<div class="csdl-geo csdl-geo-box" />',geo_boxCoordinates:'<ul><li class="nw"><label>NW:</label><span /></li><li class="ne"><label>NE:</label><span /></li><li class="se"><label>SE:</label><span /></li><li class="sw"><label>SW:</label><span /></li></ul>',geo_radius:'<div class="csdl-geo csdl-geo-radius" />',geo_radiusCoordinates:'<ul><li class="center"><label>Center:</label><span /></li><li class="radius"><label>Radius:</label><span /></li></ul>',geo_polygon:'<div class="csdl-geo csdl-geo-polygon" />',
geo_polygonCoordinates:"<ul />"}})})(CSDLEditor,window);(function(k,x,t,u,r,p,j){k.Loader.addComponent(function(d){var m=d.noop,f=d(r),h=d(p),y=d("body"),w="save value showIndicator hideIndicator fullscreen maximize minimize undo redo".split(" ");x.getPreviousToken=function(d,f,h){var j=null;f=f.line;var k=null;for(h=h.start;!(0===f&&0===h)&&!(0===h&&(f-=1,k=d.getLine(f),h="string"===typeof k?k.length+1:1),h=u.max(h-1,0),j=d.getTokenAt(x.Pos(f,h)),null!==j.type&&"comment"!==j.type););return j};k.Editor=function(f,h){var j=d(f);if(!j.length)throw Error("Not a valid DOM element given when creating CSDLEditor.Editor!");
this.$el=j.eq(0);this.options=d.extend(!0,{config:{},value:"",googleMapsApiKey:"",mapsOverlay:{strokeWeight:0,fillColor:"#7585dd",fillOpacity:0.5},mapsMarker:null,save:function(d){m(d)},autosave:function(d){m(d)}},h);this.config=d.extend(!0,CSDLEditorConfig,this.options.config);this.init()};k.Editor.prototype={$container:null,$topBar:null,$bottomBar:null,$saveBtn:null,$undoBtn:null,$redoBtn:null,$maxBtn:null,$minBtn:null,$geoBtn:null,$indicator:null,$hintHelp:null,codeMirror:null,assetsUrl:"/",$geo:null,
isGeoSelection:!1,currentGeoSelectionType:"",currentGeoSelectionValueToken:null,currentGeoSelectionValueLine:null,isFullscreen:!1,fullscreenScrollTop:0,cache:{targetHelp:{}},undoStackSize:0,originalHeight:0,init:function(){var f=this;this.$container=this.getTemplate("container").appendTo(this.$el);this.$topBar=this.$container.find("[data-bar-top]");this.$bottomBar=this.$container.find("[data-bar-bottom]");this.$help=this.$container.find("[data-help]");this.$saveBtn=this.$container.find("[data-save]");
this.$undoBtn=this.$container.find("[data-undo]");this.$redoBtn=this.$container.find("[data-redo]");this.$geoBtn=this.$container.find("[data-geo]");this.$darkBtn=this.$container.find("[data-theme-dark]");this.$lightBtn=this.$container.find("[data-theme-light]");this.$maxBtn=this.$container.find("[data-max]");this.$minBtn=this.$container.find("[data-min]");this.$helpBtn=this.$container.find("[data-help-more]");this.assetsUrl=this.guessAssetsUrl();this.options.mapsMarker||(this.options.mapsMarker=this.assetsUrl+
"images/maps-marker.png");x.extendMode("csdl",{blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * "});x.commands.save=function(){f.save()};x.commands.undo=function(){f.undo()};x.commands.redo=function(){f.redo()};var j,k=this.codeMirror=x(this.$container.find("[data-editor-container]")[0],{value:this.options.value,lineNumbers:!0,highlightSelectionMatches:!0,styleSelectedText:!0,styleActiveLine:!0,continueComments:!0,placeholder:"Enter your CSDL code...",mode:{name:"csdl",targets:this.config.targets,
operators:this.config.operators,logical:this.config.logical,keywords:this.config.keywords},extraKeys:{Esc:function(){f.minimize();return!1}},autoCloseBrackets:!0,matchBrackets:!0,onKeyEvent:function(d,h){"keyup"===h.type&&f.showHint()}});this.originalHeight=this.$container.find(".CodeMirror").height();h.on("keydown",function(d){if(83===d.which&&(d.ctrlKey||d.metaKey))return d.preventDefault(),!1});k.on("change",function(){clearTimeout(j);j=setTimeout(function(){f.trigger("autosave",[f.value()])},
500)});k.on("cursorActivity",function(){var d=k.getCursor(),h=k.getTokenAt(d);f.toggleGeoSelectionForToken(h,d);"target"===h.type?f.showTargetHelp(h.string):f.hideHelp()});var m=!1;k.on("blur",function(){setTimeout(function(){m||(f.hideHintTargetHelp(),m=!1)},100)});y.on("click",".CodeMirror-hints .CodeMirror-hint",function(){f.showHintTargetHelp(d(this));m=!0});y.on("click",".csdl-hint-help a",function(){var h=d(this);m=!1;h.is(".csdl-hint-help-more")?f.showHelpPopup(h.data("target")):r.open(h.attr("href"),
"_blank");return!1});this.$saveBtn.click(function(){f.save();return!1});this.$undoBtn.click(function(){f.undo();return!1});this.$redoBtn.click(function(){f.redo();return!1});this.$maxBtn.click(function(){f.maximize();return!1});this.$minBtn.click(function(){f.minimize();return!1});this.$geoBtn.click(function(){if(f.$geoBtn.is(".csdl-inactive")||!f.currentGeoSelectionType.length)return!1;f.isGeoSelection?f.hideGeoSelection():f.showGeoSelection(f.currentGeoSelectionType);return!1});this.$helpBtn.click(function(){f.showHelpPopup(f.$help.data("title"));
return!1});this.$lightBtn.click(function(){f.$container.removeClass("csdl-theme-dark").addClass("csdl-theme-light");f.$lightBtn.hide();f.$darkBtn.show();return!1});this.$darkBtn.click(function(){f.$container.removeClass("csdl-theme-light").addClass("csdl-theme-dark");f.$darkBtn.hide();f.$lightBtn.show();return!1});t.bind("esc",function(){f.minimize()})},save:function(){this.trigger("save",[this.value()])},undo:function(){this.codeMirror.undo();this.undoStackSize++;this.$redoBtn.removeClass("csdl-inactive")},
redo:function(){if(0>=this.undoStackSize)return!1;this.codeMirror.redo();this.undoStackSize--;0>=this.undoStackSize&&this.$redoBtn.addClass("csdl-inactive")},showIndicator:function(){this.$indicator||(this.$indicator=this.getTemplate("indicator").prependTo(this.$bottomBar))},hideIndicator:function(){this.$indicator&&(this.$indicator.remove(),this.$indicator=null)},maximize:function(){if(this.isFullscreen)return!1;var d=this;this.fullscreenScrollTop=f.scrollTop();this.$container.appendTo(y).addClass("csdl-fullscreen");
this.$maxBtn.hide();this.$minBtn.show();this.isFullscreen=!0;this.autosize();f.on("resize.csdl",function(){d.isFullscreen&&d.autosize()})},fullscreen:function(){this.maximize()},minimize:function(){if(!this.isFullscreen)return!1;this.$container.appendTo(this.$el).removeClass("csdl-fullscreen").height("auto");this.codeMirror.setSize(null,this.originalHeight);this.$maxBtn.show();this.$minBtn.hide();this.isFullscreen=!1;f.scrollTop(this.fullscreenScrollTop);f.off("resize.csdl")},showGeoSelection:function(d){d=
d===j?"box":d;this.$geo&&this.$geo.length&&this.hideGeoSelection();this.$geo=this.getTemplate("geo_"+d).append(this.getTemplate("geo")).appendTo(this.$container);this.$geo.find(".csdl-map-coordinates").html(this.getTemplate("geo_"+d+"Coordinates",{},!0));k.loadGoogleMaps(this,this.loadMaps,[d])},hideGeoSelection:function(){this.$geo.remove();this.$geo=null},showTargetHelp:function(d){var f=this;this.showIndicator();this.getTargetHelp(d,function(h){f.hideIndicator();f.showHelp(h,d)})},showHelp:function(f,
h){f=d.trim(f);h=h===j?"":d.trim(h);var k=d("<div>"+f+"</div>");this.$help.fadeIn("fast").data("full",f).data("title",h).find("[data-help-content]").html(k.find("p:first").html())},hideHelp:function(){this.$help.hide().data("full","").data("title","").find("[data-help-content]").html("")},showHelpPopup:function(f){var h=this;this.getTargetHelp(f,function(j){var k=h.getTemplate("popup",{title:f,content:j}).appendTo(y);y.on("click.csdl-help",function(f){f=d(f.target);!f.closest(".csdl-popup").length&&
!f.is(".csdl-popup")&&(y.off("click.csdl-help"),k.fadeOut(200,function(){k.remove()}))});k.find(".csdl-close").click(function(){k.fadeOut(200,function(){k.remove()});y.off("click.csdl-help");return!1})})},showHint:function(){var d=this;x.showHint(this.codeMirror,function(f){f=x.csdlHint(f);setTimeout(function(){var f=y.find(".CodeMirror-hints .CodeMirror-hint-active:first");f.length?d.showHintTargetHelp(f):d.hideHintTargetHelp()},10);return f})},showHintTargetHelp:function(h){this.hideHintTargetHelp();
var j=h.text();if(/\./.test(j)){var k=this.$hintHelp=this.getTemplate("hintHelp").appendTo(y),m=h.offset().left+h.outerWidth()+10;m+k.outerWidth()>f.width()&&(m=h.offset().left-k.outerWidth()-10);k.css({top:h.offset().top,left:m});this.getTargetHelp(j,function(f){f=d.trim(f);f=d("<div>"+f+"</div>");k.html(f.find("p:first").html()+' <a href="#" class="csdl-hint-help-more" data-target="'+j+'">More</a>')})}},hideHintTargetHelp:function(){this.$hintHelp&&(this.$hintHelp.remove(),this.$hintHelp=null)},
trigger:function(d,f){f=f||[];this.$el.trigger(d.toLowerCase(),f);return"function"===typeof this.options[d]?this.options[d].apply(this,f):null},getTargetHelp:function(f,h){h="function"!==typeof h?m:h;var k=this;if(this.cache.targetHelp[f]===j){var p=d.string.parseVariables(this.config.targetHelpJsonpSource,{target:f.replace(/\./g,"-")});d.ajax({url:p,type:"GET",async:!1,jsonpCallback:"jcsdlJSONP",contentType:"text/javascript",dataType:"jsonp",success:function(m){!m||!m.html||!d.trim(m.html)?h.apply(k,
[j]):(m=d.trim(m.html),k.cache.targetHelp[f]=m,h.apply(k,[m]))}})}else h.apply(k,[this.cache.targetHelp[f]])},getTemplate:function(f,h,m){h=h||{};m=m||!1;if(k.Templates[f]===j)throw Error("No CSDLEditor.Template named '"+f+"' found!");f=d.string.parseVariables(k.Templates[f],h);return m?f:d(f)},autosize:function(){var d=f.height();this.$container.height(d);this.codeMirror.setSize(null,d-this.$topBar.outerHeight()-this.$bottomBar.outerHeight()-50)},loadMaps:function(f){var h=this,j=new k.GeoSelection[f](this,
this.$geo);this.currentGeoSelectionValueToken&&(f=d.string.trim(this.currentGeoSelectionValueToken.string,'"'),f.length&&j.setValue(f));this.$geo.find("a[data-cancel]").click(function(){h.hideGeoSelection();h.codeMirror.focus();return!1});this.$geo.find("a[data-done]").click(function(){var d=j.getValue();h.codeMirror.replaceRange('"'+d+'"',{line:h.currentGeoSelectionValueLine,ch:h.currentGeoSelectionValueToken.start},{line:h.currentGeoSelectionValueLine,ch:h.currentGeoSelectionValueToken.end});h.hideGeoSelection();
h.codeMirror.focus();return!1})},toggleGeoSelectionForToken:function(f,h){if("string"!==f.type)return this.currentGeoSelectionType="",this.currentGeoSelectionValueLine=this.currentGeoSelectionValueToken=null,this.$geoBtn.addClass("csdl-inactive"),!1;var j=x.getPreviousToken(this.codeMirror,h,f);return"operator"===j.type&&0<=d.inArray(j.string,["geo_polygon","geo_radius","geo_box"])?(this.currentGeoSelectionType=j.string.substr(4),this.$geoBtn.removeClass("csdl-inactive"),this.currentGeoSelectionValueToken=
f,this.currentGeoSelectionValueLine=h.line,!0):!1},guessAssetsUrl:function(){var d=this.$container.find(".csdl-maps-marker-url:first"),f=d.css("background-image").replace(/url\((\'|\")?/,"").replace(/(\'|\")?\)$/,""),h=p.createElement("a");h.href=f;f=h.pathname.split("/");f.pop();f.pop();d.remove();return f.join("/")+"/"},value:function(){return this.codeMirror.getValue()}};d.fn.csdlEditor=function(f){function h(d){var j=d.data("csdlEditor");j||(j=new k.Editor(d,f),d.data("csdlEditor",j));return j}
if("string"===typeof f){var m;if(0<=d.inArray(f,w)){var p=[];d.each(arguments,function(d,f){if(!d)return!0;p.push(f)});this.each(function(){var k=h(d(this));m=k[f].apply(k,p);if(m!==j)return!1});if(m!==j)return m}return this}return this.each(function(){h(d(this))})}})})(CSDLEditor,CodeMirror,Mousetrap,Math,window,document);(function(k,x){if(x.jQuery)k.Loader.load();else{var t=document.getElementsByTagName("head"),u=document.createElement("script");u.src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js";u.type="text/javascript";t[0].appendChild(u);k.Loader.timeout(!0)}})(CSDLEditor,window);
